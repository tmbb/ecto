    <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.17.1">
    <title>Ecto.Changeset – Ecto v3.0.0-dev</title>
    <link rel="stylesheet" href="dist/app-110d9134a6.css" />
    
      <link rel="canonical" href="http://hexdocs.pm/ecto/Ecto.Changeset.html" />
    
    
      
        <link rel="icon" type="image/png" href="assets/logo.png" />
      
      
    
    <script src="dist/sidebar_items-d4f8a3d044.js"></script>
    <link rel="stylesheet" href="assets/makedown.css"/>
  </head>
  <body data-type="modules">
    <script>try { if(localStorage.getItem('night-mode')) document.body.className += ' night-mode'; } catch (e) { }</script>

    <div class="main">
<button class="sidebar-toggle">
  <span class="icon-menu" aria-hidden="true"></span>
  <span class="sr-only">Toggle Sidebar</span>
</button>
<section class="sidebar">

  
  <a href="Ecto.html" class="sidebar-projectLink">
    <div class="sidebar-projectDetails">
      <h1 class="sidebar-projectName">
        Ecto
      </h1>
      <h2 class="sidebar-projectVersion">
        v3.0.0-dev
      </h2>
    </div>
    
      <img src="assets/logo.png" alt="Ecto" class="sidebar-projectImage">
    
  </a>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button">
      <span class="icon-search" aria-hidden="true"></span>
    </button>
    <input name="q" type="text" id="search-list" class="search-input" placeholder="search" aria-label="Search" autocomplete="off" />
  </form>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">Pages</a></li>

    
      <li><a id="modules-list" href="#full-list">Modules</a></li>
    

    
      <li><a id="exceptions-list" href="#full-list">Exceptions</a></li>
    

    
      <li><a id="tasks-list" href="#full-list">Mix Tasks</a></li>
    
  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">


      <h1>
        <small class="visible-xs">Ecto v3.0.0-dev</small>
        Ecto.Changeset
        
          <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1" title="View Source" class="view-source" rel="help">
            <span class="icon-code" aria-hidden="true"></span>
            <span class="sr-only">View Source</span>
          </a>
        
      </h1>

      
        <section id="moduledoc">
          <p>Changesets allow filtering, casting, validation and
definition of constraints when manipulating structs.</p>
<p>There is an example of working with changesets in the introductory
documentation in the <a href="Ecto.html"><code class="inline">Ecto</code></a> module. The functions <a href="#cast/4"><code class="inline">cast/4</code></a> and
<a href="#change/2"><code class="inline">change/2</code></a> are the usual entry points for creating changesets.
The first one is used to cast and validate external parameters,
such as parameters sent through a form, API, command line, etc.
The second one is used to change data directly from your application.</p>
<p>The remaining functions in this module, such as validations,
constraints, association handling, are about manipulating
changesets. Let’s discuss some of this extra functionality.</p>
<h2 id="module-external-vs-internal-data" class="section-heading">
  <a href="#module-external-vs-internal-data" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  External vs internal data
</h2>

<p>Changesets allow working with both kinds of data:</p>
<ul>
<li><p>internal to the application - for example programatically generated,
or coming from other subsystems. This use case is primarily covered
by the <a href="#change/2"><code class="inline">change/2</code></a> and <a href="#put_change/3"><code class="inline">put_change/3</code></a> functions.</p>
</li>
<li><p>external to the application - for example data provided by the user in
a form that needs to be type-converted and properly validated. This use case
is primarily covered by the <a href="#cast/4"><code class="inline">cast/4</code></a> function.</p>
</li>
</ul>
<h2 id="module-validations-and-constraints" class="section-heading">
  <a href="#module-validations-and-constraints" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Validations and constraints
</h2>

<p>Ecto changesets provide both validations and constraints which
are ultimately turned into errors in case something goes wrong.</p>
<p>The difference between them is that most validations can be
executed without a need to interact with the database and, therefore,
are always executed before attempting to insert or update the entry
in the database. Some validations may happen against the database but
they are inherently unsafe. Those validations start with a <code class="inline">unsafe_</code>
prefix, such as <a href="#unsafe_validate_unique/3"><code class="inline">unsafe_validate_unique/3</code></a>.</p>
<p>On the other hand, constraints rely on the database and are always safe.
As a consequence, validations are always checked before constraints.
Constraints won’t even be checked in case validations failed.</p>
<p>Let’s see an example:</p>
<pre><code class="nohighlight makeup"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="k" data-group-id="2597">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s2">&quot;users&quot;</span><span class="w"> </span><span class="k" data-group-id="2398">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:name</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:email</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:age</span><span class="p">,</span><span class="w"> </span><span class="ss">:integer</span><span class="w">
  </span><span class="k" data-group-id="2398">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">changeset</span><span class="p" data-group-id="2445">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="2444">%{}</span><span class="p" data-group-id="2445">)</span><span class="w"> </span><span class="k" data-group-id="2596">do</span><span class="w">
    </span><span class="n">user</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="2521">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2520">[</span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">:age</span><span class="p" data-group-id="2520">]</span><span class="p" data-group-id="2521">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">validate_required</span><span class="p" data-group-id="2547">(</span><span class="p" data-group-id="2546">[</span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p" data-group-id="2546">]</span><span class="p" data-group-id="2547">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">validate_format</span><span class="p" data-group-id="2564">(</span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="sr">~r/@/</span><span class="p" data-group-id="2564">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">validate_inclusion</span><span class="p" data-group-id="2585">(</span><span class="ss">:age</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="o">..</span><span class="mi">100</span><span class="p" data-group-id="2585">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">unique_constraint</span><span class="p" data-group-id="2592">(</span><span class="ss">:email</span><span class="p" data-group-id="2592">)</span><span class="w">
  </span><span class="k" data-group-id="2596">end</span><span class="w">
</span><span class="k" data-group-id="2597">end</span></code></pre>
<p>In the <code class="inline">changeset/2</code> function above, we define three validations.
They check that <code class="inline">name</code> and <code class="inline">email</code> fields are present in the
changeset, the e-mail is of the specified format, and the age is
between 18 and 100 - as well as a unique constraint in the email
field.</p>
<p>Let’s suppose the e-mail is given but the age is invalid. The
changeset would have the following errors:</p>
<pre><code class="nohighlight makeup"><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2417">(</span><span class="p" data-group-id="2324">%</span><span class="nc" data-group-id="2324">User</span><span class="p" data-group-id="2324">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2416">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mary@example.com&quot;</span><span class="p" data-group-id="2416">}</span><span class="p" data-group-id="2417">)</span><span class="w">
</span><span class="p" data-group-id="2435">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="2435">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="2491">(</span><span class="n">changeset</span><span class="p" data-group-id="2491">)</span><span class="w">
</span><span class="n">changeset</span><span class="o">.</span><span class="n">errors</span><span class="w"> </span><span class="c1">#=&gt; [age: {&quot;is invalid&quot;, []}, name: {&quot;can&apos;t be blank&quot;, []}]</span></code></pre>
<p>In this case, we haven’t checked the unique constraint in the
e-mail field because the data did not validate. Let’s fix the
age and assume, however, that the e-mail already exists in the
database:</p>
<pre><code class="nohighlight makeup"><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2411">(</span><span class="p" data-group-id="2329">%</span><span class="nc" data-group-id="2329">User</span><span class="p" data-group-id="2329">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2410">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mary@example.com&quot;</span><span class="p" data-group-id="2410">}</span><span class="p" data-group-id="2411">)</span><span class="w">
</span><span class="p" data-group-id="2431">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="2431">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="2474">(</span><span class="n">changeset</span><span class="p" data-group-id="2474">)</span><span class="w">
</span><span class="n">changeset</span><span class="o">.</span><span class="n">errors</span><span class="w"> </span><span class="c1">#=&gt; [email: {&quot;has already been taken&quot;, []}]</span></code></pre>
<p>Validations and constraints define an explicit boundary when the check
happens. By moving constraints to the database, we also provide a safe,
correct and data-race free means of checking the user input.</p>
<h2 id="module-empty-values" class="section-heading">
  <a href="#module-empty-values" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Empty values
</h2>

<p>Many times, the data given on cast needs to be further pruned, specially
regarding empty values. For example, if you are gathering data to be
cast from the command line or through an HTML form or any other text-based
format, it is likely those means cannot express nil values. For
those reasons, changesets include the concept of empty values, which are
values that will be automatically converted to the field’s default value
on <a href="#cast/4"><code class="inline">cast/4</code></a>. Those values are stored in the changeset <code class="inline">empty_values</code> field
and default to <code class="inline">[&quot;&quot;]</code>.</p>
<h2 id="module-associations-embeds-and-on-replace" class="section-heading">
  <a href="#module-associations-embeds-and-on-replace" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Associations, embeds and on replace
</h2>

<p>Using changesets you can work with associations as well as with embedded
structs. Changesets provide a convenient way to working with associations
as whole values - for example considering the entire list of has_many
associations and not focusing just on a single one. Two main functions
that provide this functionality are <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> for working with external
data, and <a href="#put_assoc/3"><code class="inline">put_assoc/3</code></a> for working with internal data - the difference
between those two functions is analogical to the difference between
<a href="#cast/4"><code class="inline">cast/4</code></a> and <a href="#change/2"><code class="inline">change/2</code></a>.</p>
<p>Sometimes related data may be replaced by incoming data and by
default Ecto won’t allow such. Such behaviour can be changed when defining
the relation by setting <code class="inline">:on_replace</code> option in your association/embed
definition according to the values below:</p>
<ul>
<li><code class="inline">:raise</code> (default) - do not allow removing association or embedded
data via parent changesets
</li>
<li><code class="inline">:mark_as_invalid</code> - if attempting to remove the association or
embedded data via parent changeset - an error will be added to the parent
changeset, and it will be marked as invalid
</li>
<li><code class="inline">:nilify</code> - sets owner reference column to <code class="inline">nil</code> (available only for
associations)
</li>
<li><code class="inline">:update</code> - updates the association, available only for has_one and belongs_to.
This option will update all the fields given to the changeset including the id
for the association
</li>
<li><code class="inline">:delete</code> - removes the association or related data from the database.
This option has to be used carefully
</li>
</ul>
<p>The <code class="inline">:delete</code> option in particular must be used carefully as it would allow
users to delete any associated data. If you need deletion, it is often preferred
to add a separate boolean virtual field to the changeset function that will allow
you to manually mark it for deletion, as in the example below:</p>
<pre><code class="nohighlight makeup"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Comment</span><span class="w"> </span><span class="k" data-group-id="2576">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s2">&quot;comments&quot;</span><span class="w"> </span><span class="k" data-group-id="2419">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:body</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:delete</span><span class="p">,</span><span class="w"> </span><span class="ss">:boolean</span><span class="p">,</span><span class="w"> </span><span class="ss">virtual</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="w">
  </span><span class="k" data-group-id="2419">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">changeset</span><span class="p" data-group-id="2458">(</span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p" data-group-id="2458">)</span><span class="w"> </span><span class="k" data-group-id="2533">do</span><span class="w">
    </span><span class="n">cast</span><span class="p" data-group-id="2516">(</span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2515">[</span><span class="ss">:body</span><span class="p">,</span><span class="w"> </span><span class="ss">:delete</span><span class="p" data-group-id="2515">]</span><span class="p" data-group-id="2516">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">maybe_mark_for_deletion</span><span class="w">
  </span><span class="k" data-group-id="2533">end</span><span class="w">

  </span><span class="kd">defp</span><span class="w"> </span><span class="n">maybe_mark_for_deletion</span><span class="p" data-group-id="2541">(</span><span class="n">changeset</span><span class="p" data-group-id="2541">)</span><span class="w"> </span><span class="k" data-group-id="2574">do</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">get_change</span><span class="p" data-group-id="2554">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:delete</span><span class="p" data-group-id="2554">)</span><span class="w"> </span><span class="k" data-group-id="2573">do</span><span class="w">
      </span><span class="p" data-group-id="2570">%{</span><span class="n">changeset</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="ss">action</span><span class="p">:</span><span class="w"> </span><span class="ss">:delete</span><span class="p" data-group-id="2570">}</span><span class="w">
    </span><span class="k" data-group-id="2573">else</span><span class="w">
      </span><span class="n">changeset</span><span class="w">
    </span><span class="k" data-group-id="2573">end</span><span class="w">
  </span><span class="k" data-group-id="2574">end</span><span class="w">
</span><span class="k" data-group-id="2576">end</span></code></pre>
<h2 id="module-schemaless-changesets" class="section-heading">
  <a href="#module-schemaless-changesets" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Schemaless changesets
</h2>

<p>In the changeset examples so far, we have always used changesets to
validate and cast data contained in a struct, such as the <code class="inline">%User{}</code>
struct defined by the <code class="inline">User</code> module.</p>
<p>However, changesets can also be used with data in a plain map, by
passing a tuple containing both the data and the supported types:</p>
<pre><code class="nohighlight makeup"><span class="n">data</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2291">%{}</span><span class="w">
</span><span class="n">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2370">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"> </span><span class="ss">:string</span><span class="p">,</span><span class="w"> </span><span class="ss">last_name</span><span class="p">:</span><span class="w"> </span><span class="ss">:string</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="ss">:string</span><span class="p" data-group-id="2370">}</span><span class="w">

</span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="p" data-group-id="2414">{</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p" data-group-id="2414">}</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">cast</span><span class="p" data-group-id="2524">(</span><span class="n">params</span><span class="p" data-group-id="2490">[</span><span class="s2">&quot;sign_up&quot;</span><span class="p" data-group-id="2490">]</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">keys</span><span class="p" data-group-id="2523">(</span><span class="n">types</span><span class="p" data-group-id="2523">)</span><span class="p" data-group-id="2524">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">validate_required</span><span class="p" data-group-id="2557">(</span><span class="o">...</span><span class="p" data-group-id="2557">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">validate_length</span><span class="p" data-group-id="2575">(</span><span class="o">...</span><span class="p" data-group-id="2575">)</span></code></pre>
<p>Such functionality makes Ecto extremely useful to cast, validate and prune
data even if it is not meant to be persisted to the database.</p>
<h3 id="module-changeset-actions" class="section-heading">
  <a href="#module-changeset-actions" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Changeset actions
</h3>

<p>Changesets have an action field which is usually set by <a href="Ecto.Repo.html"><code class="inline">Ecto.Repo</code></a>
whenever one of the operations such as <code class="inline">insert</code> or <code class="inline">update</code> is called:</p>
<pre><code class="nohighlight makeup"><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2408">(</span><span class="p" data-group-id="2319">%</span><span class="nc" data-group-id="2319">User</span><span class="p" data-group-id="2319">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2407">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mary@example.com&quot;</span><span class="p" data-group-id="2407">}</span><span class="p" data-group-id="2408">)</span><span class="w">
</span><span class="p" data-group-id="2432">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="2432">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="2485">(</span><span class="n">changeset</span><span class="p" data-group-id="2485">)</span><span class="w">
</span><span class="n">changeset</span><span class="o">.</span><span class="n">action</span><span class="w">
</span><span class="c1">#=&gt; :insert</span></code></pre>
<p>This means that when working with changesets that are not meant to be
persisted to the database, such as schemaless changesets, you may need
to explicitly set the action to one specific value. Frameworks such as
Phoenix uses the action value to define how a HTML forms should act.</p>
<p>Instead of setting the action manually, you may use <a href="#apply_action/2"><code class="inline">apply_action/2</code></a> that
emulates operations such as <code class="inline">Repo.insert</code>. <a href="#apply_action/2"><code class="inline">apply_action/2</code></a> will return
<code class="inline">{:ok, changes}</code> if the changeset is valid or <code class="inline">{:error, changeset}</code>, with
the given <code class="inline">action</code> set in the changeset in case of errors.</p>
<h2 id="module-the-ecto-changeset-struct" class="section-heading">
  <a href="#module-the-ecto-changeset-struct" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  The Ecto.Changeset struct
</h2>

<p>The fields are:</p>
<ul>
<li><code class="inline">valid?</code>       - Stores if the changeset is valid
</li>
<li><code class="inline">data</code>         - The changeset source data, for example, a struct
</li>
<li><code class="inline">params</code>       - The parameters as given on changeset creation
</li>
<li><code class="inline">changes</code>      - The <code class="inline">changes</code> from parameters that were approved in casting
</li>
<li><code class="inline">errors</code>       - All errors from validations
</li>
<li><code class="inline">validations</code>  - All validations performed in the changeset
</li>
<li><code class="inline">constraints</code>  - All constraints defined in the changeset
</li>
<li><code class="inline">required</code>     - All required fields as a list of atoms
</li>
<li><code class="inline">filters</code>      - Filters (as a map <code class="inline">%{field =&gt; value}</code>) to narrow the scope of update/delete queries
</li>
<li><code class="inline">action</code>       - The action to be performed with the changeset
</li>
<li><code class="inline">types</code>        - Cache of the data’s field types
</li>
<li><code class="inline">empty_values</code> - A list of values to be considered empty
</li>
<li><code class="inline">repo</code>         - The repository applying the changeset (only set after a Repo function is called)
</li>
<li><code class="inline">repo_opts</code>    - A keyword list of options given to the underlying repository operation
</li>
</ul>

        </section>
      

      
        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Summary
          </h1>
          
  <div class="summary-types summary">
    <h2>
      <a href="#types">Types</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#t:action/0">action()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:constraint/0">constraint()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:data/0">data()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:error/0">error()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:t/0">t()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:types/0">types()</a>
  </div>
  
</div>

  </div>


          
  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#add_error/4">add_error(changeset, key, message, keys \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Adds an error to the changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#apply_action/2">apply_action(changeset, action)</a>
  </div>
  
    <div class="summary-synopsis"><p>Applies the changeset action only if the changes are valid</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#apply_changes/1">apply_changes(changeset)</a>
  </div>
  
    <div class="summary-synopsis"><p>Applies the changeset changes to the changeset data</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#assoc_constraint/3">assoc_constraint(changeset, assoc, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks the associated field exists</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#cast/4">cast(data, params, permitted, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Applies the given <code class="inline">params</code> as changes for the given <code class="inline">data</code> according to
the given set of keys. Returns a changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#cast_assoc/3">cast_assoc(changeset, name, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Casts the given association with the changeset parameters</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#cast_embed/3">cast_embed(changeset, name, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Casts the given embed with the changeset parameters</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#change/2">change(data, changes \\ %{})</a>
  </div>
  
    <div class="summary-synopsis"><p>Wraps the given data in a changeset or adds changes to a changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#check_constraint/3">check_constraint(changeset, field, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks for a check constraint in the given field</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete_change/2">delete_change(changeset, key)</a>
  </div>
  
    <div class="summary-synopsis"><p>Deletes a change with the given key</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#exclusion_constraint/3">exclusion_constraint(changeset, field, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks for an exclusion constraint in the given field</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#fetch_change/2">fetch_change(changeset, key)</a>
  </div>
  
    <div class="summary-synopsis"><p>Fetches a change from the given changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#fetch_field/2">fetch_field(changeset, key)</a>
  </div>
  
    <div class="summary-synopsis"><p>Fetches the given field from changes or from the data</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#force_change/3">force_change(changeset, key, value)</a>
  </div>
  
    <div class="summary-synopsis"><p>Forces a change on the given <code class="inline">key</code> with <code class="inline">value</code></p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#foreign_key_constraint/3">foreign_key_constraint(changeset, field, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks for foreign key constraint in the given field</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get_change/3">get_change(changeset, key, default \\ nil)</a>
  </div>
  
    <div class="summary-synopsis"><p>Gets a change or returns a default value</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get_field/3">get_field(changeset, key, default \\ nil)</a>
  </div>
  
    <div class="summary-synopsis"><p>Gets a field from changes or from the data</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#merge/2">merge(changeset1, changeset2)</a>
  </div>
  
    <div class="summary-synopsis"><p>Merges two changesets</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#no_assoc_constraint/3">no_assoc_constraint(changeset, assoc, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks the associated field does not exist</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#optimistic_lock/3">optimistic_lock(data_or_changeset, field, incrementer \\ &amp;(&amp;1 + 1))</a>
  </div>
  
    <div class="summary-synopsis"><p>Applies optimistic locking to the changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#prepare_changes/2">prepare_changes(changeset, function)</a>
  </div>
  
    <div class="summary-synopsis"><p>Provides a function to run before emitting changes to the repository</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#put_assoc/4">put_assoc(changeset, name, value, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Puts the given association as a change in the changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#put_change/3">put_change(changeset, key, value)</a>
  </div>
  
    <div class="summary-synopsis"><p>Puts a change on the given <code class="inline">key</code> with <code class="inline">value</code></p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#put_embed/4">put_embed(changeset, name, value, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Puts the given embed as a change in the changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#traverse_errors/2">traverse_errors(changeset, msg_func)</a>
  </div>
  
    <div class="summary-synopsis"><p>Traverses changeset errors and applies the given function to error messages</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#unique_constraint/3">unique_constraint(changeset, field, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks for a unique constraint in the given field</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#unsafe_validate_unique/4">unsafe_validate_unique(changeset, fields, repo, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates that no existing record with a different primary key
has the same values for these fields</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#update_change/3">update_change(changeset, key, function)</a>
  </div>
  
    <div class="summary-synopsis"><p>Updates a change</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_acceptance/3">validate_acceptance(changeset, field, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates the given parameter was given as true</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_change/3">validate_change(changeset, field, validator)</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates the given <code class="inline">field</code> change</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_change/4">validate_change(changeset, field, metadata, validator)</a>
  </div>
  
    <div class="summary-synopsis"><p>Stores the validation <code class="inline">metadata</code> and validates the given <code class="inline">field</code> change</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_confirmation/3">validate_confirmation(changeset, field, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates that the given field matches the confirmation
parameter of that field</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_exclusion/4">validate_exclusion(changeset, field, data, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates a change is not included in the given enumerable</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_format/4">validate_format(changeset, field, format, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates a change has the given format</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_inclusion/4">validate_inclusion(changeset, field, data, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates a change is included in the given enumerable</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_length/3">validate_length(changeset, field, opts)</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates a change is a string or list of the given length</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_number/3">validate_number(changeset, field, opts)</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates the properties of a number</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_required/3">validate_required(changeset, fields, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates that one or more fields are present in the changeset</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#validate_subset/4">validate_subset(changeset, field, data, opts \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Validates a change, of type enum, is a subset of the given enumerable. Like
<a href="#validate_inclusion/4"><code class="inline">validate_inclusion/4</code></a> for lists</p>
</div>
  
</div>

  </div>


          

        </section>
      

      
        <section id="types" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#types">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Types
          </h1>
          <div class="types-list">
            <div class="detail" id="t:action/0">
  
  
  <div class="detail-header">
    <a href="#t:action/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">action()</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L251" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>action() :: nil | :insert | :update | :delete | :replace | :ignore</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="t:constraint/0">
  
  
  <div class="detail-header">
    <a href="#t:constraint/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">constraint()</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L252" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>constraint() :: %{type: :unique, constraint: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>, match: :exact | :suffix, field: atom, message: <a href="#t:error/0">error</a>}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="t:data/0">
  
  
  <div class="detail-header">
    <a href="#t:data/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">data()</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L254" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>data() :: map</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="t:error/0">
  
  
  <div class="detail-header">
    <a href="#t:error/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">error()</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L250" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>error() :: {<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="t:t/0">
  
  
  <div class="detail-header">
    <a href="#t:t/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">t()</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L235" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>t() :: %Ecto.Changeset{action: <a href="#t:action/0">action</a>, changes: %{optional(atom) => term}, constraints: [<a href="#t:constraint/0">constraint</a>], data: <a href="Ecto.Schema.html#t:t/0">Ecto.Schema.t</a> | map | nil, empty_values: term, errors: [{atom, <a href="#t:error/0">error</a>}], filters: %{optional(atom) => term}, params: %{optional(<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>) => term} | nil, prepare: [(<a href="#t:t/0">t</a> -> <a href="#t:t/0">t</a>)], repo: atom | nil, repo_opts: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>, required: [atom], types: nil | %{optional(atom) => <a href="Ecto.Type.html#t:t/0">Ecto.Type.t</a>}, valid?: boolean, validations: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="t:types/0">
  
  
  <div class="detail-header">
    <a href="#t:types/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">types()</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L255" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>types() :: map</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>

          </div>
        </section>
      

      
        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Functions
          </h1>
          <div class="detail" id="add_error/4">
  
  
    <span id="add_error/3"></span>
  
  <div class="detail-header">
    <a href="#add_error/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">add_error(changeset, key, message, keys \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1275" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>add_error(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Adds an error to the changeset.</p>
<p>An additional keyword list <code class="inline">keys</code> can be passed to provide additional
contextual information for the error. This is useful when using
<a href="#traverse_errors/2"><code class="inline">traverse_errors/2</code></a></p>
<h2 id="add_error/4-examples" class="section-heading">
  <a href="#add_error/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="2680">(</span><span class="p" data-group-id="2672">%</span><span class="nc" data-group-id="2672">Post</span><span class="p" data-group-id="2672">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2679">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p" data-group-id="2679">}</span><span class="p" data-group-id="2680">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_error</span><span class="p" data-group-id="2693">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;empty&quot;</span><span class="p" data-group-id="2693">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">errors</span><span class="w">
</span><span class="p" data-group-id="2712">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2711">{</span><span class="s2">&quot;empty&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2710">[]</span><span class="p" data-group-id="2711">}</span><span class="p" data-group-id="2712">]</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w">
</span><span class="no">false</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="2740">(</span><span class="p" data-group-id="2729">%</span><span class="nc" data-group-id="2729">Post</span><span class="p" data-group-id="2729">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2739">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p" data-group-id="2739">}</span><span class="p" data-group-id="2740">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_error</span><span class="p" data-group-id="2757">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;empty&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">additional</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p" data-group-id="2757">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">errors</span><span class="w">
</span><span class="p" data-group-id="2789">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2788">{</span><span class="s2">&quot;empty&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2787">[</span><span class="ss">additional</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p" data-group-id="2787">]</span><span class="p" data-group-id="2788">}</span><span class="p" data-group-id="2789">]</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w">
</span><span class="no">false</span></code></pre>

  </section>
</div>
<div class="detail" id="apply_action/2">
  
  
  <div class="detail-header">
    <a href="#apply_action/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">apply_action(changeset, action)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1245" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>apply_action(<a href="#t:t/0">t</a>, <a href="#t:action/0">action</a>) ::
  {:ok, <a href="Ecto.Schema.html#t:t/0">Ecto.Schema.t</a> | <a href="#t:data/0">data</a>} |
  {:error, <a href="#t:t/0">t</a>}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Applies the changeset action only if the changes are valid.</p>
<p>If the changes are valid, all changes are applied to the changeset data.
If the changes are invalid, no changes are applied, and an error tuple
is returned with the changeset containing the action that was attempted
to be applied.</p>
<p>The action may be one of <code class="inline">:insert</code>, <code class="inline">:update</code>, <code class="inline">:delete</code>, <code class="inline">:replace</code>.</p>
<h2 id="apply_action/2-examples" class="section-heading">
  <a href="#apply_action/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="p" data-group-id="2813">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p" data-group-id="2813">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_action</span><span class="p" data-group-id="2818">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:update</span><span class="p" data-group-id="2818">)</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="p" data-group-id="2821">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="2821">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_action</span><span class="p" data-group-id="2828">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:update</span><span class="p" data-group-id="2828">)</span><span class="w">
</span><span class="p" data-group-id="2832">%</span><span class="nc" data-group-id="2832">Ecto.Changeset</span><span class="p" data-group-id="2832">{</span><span class="ss">action</span><span class="p">:</span><span class="w"> </span><span class="ss">:update</span><span class="p" data-group-id="2832">}</span></code></pre>

  </section>
</div>
<div class="detail" id="apply_changes/1">
  
  
  <div class="detail-header">
    <a href="#apply_changes/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">apply_changes(changeset)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1207" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>apply_changes(<a href="#t:t/0">t</a>) :: <a href="Ecto.Schema.html#t:t/0">Ecto.Schema.t</a> | <a href="#t:data/0">data</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Applies the changeset changes to the changeset data.</p>
<p>This operation will return the underlying data with changes
regardless if the changeset is valid or not.</p>
<h2 id="apply_changes/1-examples" class="section-heading">
  <a href="#apply_changes/1-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="2855">(</span><span class="p" data-group-id="2843">%</span><span class="nc" data-group-id="2843">Post</span><span class="p" data-group-id="2843">{</span><span class="ss">author</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="2843">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2854">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="2854">}</span><span class="p" data-group-id="2855">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">apply_changes</span><span class="p" data-group-id="2860">(</span><span class="n">changeset</span><span class="p" data-group-id="2860">)</span><span class="w">
</span><span class="p" data-group-id="2865">%</span><span class="nc" data-group-id="2865">Post</span><span class="p" data-group-id="2865">{</span><span class="ss">author</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="2865">}</span></code></pre>

  </section>
</div>
<div class="detail" id="assoc_constraint/3">
  
  
    <span id="assoc_constraint/2"></span>
  
  <div class="detail-header">
    <a href="#assoc_constraint/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">assoc_constraint(changeset, assoc, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L2174" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>assoc_constraint(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a> | no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Checks the associated field exists.</p>
<p>This is similar to <a href="#foreign_key_constraint/3"><code class="inline">foreign_key_constraint/3</code></a> except that the
field is inferred from the association definition. This is useful
to guarantee that a child will only be created if the parent exists
in the database too. Therefore, it only applies to <code class="inline">belongs_to</code>
associations.</p>
<p>As the name says, a constraint is required in the database for
this function to work. Such constraint is often added as a
reference to the child table:</p>
<pre><code class="nohighlight makeup"><span class="n">create</span><span class="w"> </span><span class="n">table</span><span class="p" data-group-id="2878">(</span><span class="ss">:comments</span><span class="p" data-group-id="2878">)</span><span class="w"> </span><span class="k" data-group-id="2882">do</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="ss">:post_id</span><span class="p">,</span><span class="w"> </span><span class="n">references</span><span class="p" data-group-id="2881">(</span><span class="ss">:posts</span><span class="p" data-group-id="2881">)</span><span class="w">
</span><span class="k" data-group-id="2882">end</span></code></pre>
<p>Now, when inserting a comment, it is possible to forbid any
comment to be added if the associated post does not exist:</p>
<pre><code class="nohighlight makeup"><span class="n">comment</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">cast</span><span class="p" data-group-id="2892">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2891">[</span><span class="ss">:post_id</span><span class="p" data-group-id="2891">]</span><span class="p" data-group-id="2892">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">assoc_constraint</span><span class="p" data-group-id="2907">(</span><span class="ss">:post</span><span class="p" data-group-id="2907">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert</span></code></pre>
<h2 id="assoc_constraint/3-options" class="section-heading">
  <a href="#assoc_constraint/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message in case the constraint check fails,
defaults to “does not exist”
</li>
<li><code class="inline">:name</code> - the constraint name. By default, the constraint
name is inferred from the table + association field.
May be required explicitly for complex cases
</li>
</ul>

  </section>
</div>
<div class="detail" id="cast/4">
  
  
    <span id="cast/3"></span>
  
  <div class="detail-header">
    <a href="#cast/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">cast(data, params, permitted, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L428" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>cast(<a href="Ecto.Schema.html#t:t/0">Ecto.Schema.t</a> | <a href="#t:t/0">t</a> | {<a href="#t:data/0">data</a>, <a href="#t:types/0">types</a>}, %{optional(binary) => term} | %{optional(atom) => term} | :invalid, [<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a> | atom], <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) ::
  <a href="#t:t/0">t</a> |
  no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Applies the given <code class="inline">params</code> as changes for the given <code class="inline">data</code> according to
the given set of keys. Returns a changeset.</p>
<p>The given <code class="inline">data</code> may be either a changeset, a schema struct or a <code class="inline">{data, types}</code>
tuple. The second argument is a map of <code class="inline">params</code> that are cast according
to the type information from <code class="inline">data</code>. <code class="inline">params</code> is a map with string keys
or a map with atom keys containing potentially unsafe data.</p>
<p>During casting, all <code class="inline">permitted</code> parameters will have their key name converted
to an atom and stored as a change in the <code class="inline">:changes</code> field of the changeset.
All parameters that are not explicitly permitted are ignored.</p>
<p>If casting of all fields is successful, the changeset is returned as valid.</p>
<h2 id="cast/4-options" class="section-heading">
  <a href="#cast/4-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:empty_values</code> - a list of values to be considered as empty when casting.
Defaults to the changeset value, which defaults to <code class="inline">[&quot;&quot;]</code>
</li>
</ul>
<h2 id="cast/4-examples" class="section-heading">
  <a href="#cast/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="2950">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2949">[</span><span class="ss">:title</span><span class="p" data-group-id="2949">]</span><span class="p" data-group-id="2950">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w"> </span><span class="k" data-group-id="2974">do</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="nc">Repo</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="2972">(</span><span class="n">changeset</span><span class="p" data-group-id="2972">)</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w"> </span><span class="k" data-group-id="2974">end</span></code></pre>
<p>Passing a changeset as the first argument:</p>
<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="2967">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2957">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span><span class="p" data-group-id="2957">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2966">[</span><span class="ss">:title</span><span class="p" data-group-id="2966">]</span><span class="p" data-group-id="2967">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">new_changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="3000">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2989">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bar&quot;</span><span class="p" data-group-id="2989">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2999">[</span><span class="ss">:body</span><span class="p" data-group-id="2999">]</span><span class="p" data-group-id="3000">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">new_changeset</span><span class="o">.</span><span class="n">params</span><span class="w">
</span><span class="p" data-group-id="3022">%{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;Foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;body&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;Bar&quot;</span><span class="p" data-group-id="3022">}</span></code></pre>
<p>Or creating a changeset from a simple map with types:</p>
<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2948">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p" data-group-id="2948">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2959">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="ss">:string</span><span class="p" data-group-id="2959">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="2992">(</span><span class="p" data-group-id="2973">{</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p" data-group-id="2973">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2982">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p" data-group-id="2982">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2991">[</span><span class="ss">:title</span><span class="p" data-group-id="2991">]</span><span class="p" data-group-id="2992">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">apply_changes</span><span class="p" data-group-id="3001">(</span><span class="n">changeset</span><span class="p" data-group-id="3001">)</span><span class="w">
</span><span class="p" data-group-id="3005">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p" data-group-id="3005">}</span></code></pre>
<h2 id="cast/4-composing-casts" class="section-heading">
  <a href="#cast/4-composing-casts" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Composing casts
</h2>

<p><a href="#cast/4"><code class="inline">cast/4</code></a> also accepts a changeset as its first argument. In such cases, all
the effects caused by the call to <a href="#cast/4"><code class="inline">cast/4</code></a> (additional errors and changes)
are simply added to the ones already present in the argument changeset.
Parameters are merged (<strong>not deep-merged</strong>) and the ones passed to <a href="#cast/4"><code class="inline">cast/4</code></a>
take precedence over the ones already in the changeset.</p>

  </section>
</div>
<div class="detail" id="cast_assoc/3">
  
  
    <span id="cast_assoc/2"></span>
  
  <div class="detail-header">
    <a href="#cast_assoc/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">cast_assoc(changeset, name, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L659" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Casts the given association with the changeset parameters.</p>
<p>This function should be used when working with the entire association at
once (and not a single element of a many-style association) and using data
external to the application.</p>
<p>When updating the data, this function requires the association to have been
preloaded in the changeset struct. Missing data will
invoke the <code class="inline">:on_replace</code> behaviour defined on the association.
Preloading is not necessary for newly built structs.</p>
<p>The parameters for the given association will be retrieved
from <code class="inline">changeset.params</code>. Those parameters are expected to be
a map with attributes, similar to the ones passed to <a href="#cast/4"><code class="inline">cast/4</code></a>.
Once parameters are retrieved, <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> will match those
parameters with the associations already in the changeset record.</p>
<p>For example, imagine a user has many addresses relationship where
post data is sent as follows</p>
<pre><code class="nohighlight makeup"><span class="p" data-group-id="3182">%{</span><span class="s2">&quot;name&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;john doe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;addresses&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3181">[</span><span class="w">
  </span><span class="p" data-group-id="3152">%{</span><span class="s2">&quot;street&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;somewhere&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;brazil&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3152">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3179">%{</span><span class="s2">&quot;street&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;elsewhere&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;poland&quot;</span><span class="p" data-group-id="3179">}</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="3181">]</span><span class="p" data-group-id="3182">}</span></code></pre>
<p>and then</p>
<pre><code class="nohighlight makeup"><span class="n">user</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="p" data-group-id="3058">(</span><span class="ss">:addresses</span><span class="p" data-group-id="3058">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">cast</span><span class="p" data-group-id="3077">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3076">[]</span><span class="p" data-group-id="3077">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">cast_assoc</span><span class="p" data-group-id="3111">(</span><span class="ss">:addresses</span><span class="p" data-group-id="3111">)</span></code></pre>
<p>Once <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> is called, Ecto will compare those parameters
with the addresses already associated with the user and act as follows:</p>
<ul>
<li>If the parameter does not contain an ID, the parameter data
will be passed to <code class="inline">changeset/2</code> with a new struct and become
an insert operation
</li>
<li>If the parameter contains an ID and there is no associated child
with such ID, the parameter data will be passed to <code class="inline">changeset/2</code>
with a new struct and become an insert operation
</li>
<li>If the parameter contains an ID and there is an associated child
with such ID, the parameter data will be passed to <code class="inline">changeset/2</code>
with the existing struct and become an update operation
</li>
<li>If there is an associated child with an ID and its ID is not given
as parameter, the <code class="inline">:on_replace</code> callback for that association will
be invoked (see the “On replace” section on the module documentation)
</li>
</ul>
<p>Every time the <code class="inline">changeset/2</code> function is invoked, it must return a changeset.
Note developers are allowed to explicitly set the <code class="inline">:action</code> field of a
changeset to instruct Ecto how to act in certain situations. Let’s suppose
that, if one of the associations has only empty fields, you want to ignore
the entry altogether instead of showing an error. The changeset function could
be written like this:</p>
<pre><code class="nohighlight makeup"><span class="kd">def</span><span class="w"> </span><span class="nf">changeset</span><span class="p" data-group-id="3052">(</span><span class="n">struct</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p" data-group-id="3052">)</span><span class="w"> </span><span class="k" data-group-id="3162">do</span><span class="w">
  </span><span class="n">struct</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="3075">(</span><span class="n">struct</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3074">[</span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">:body</span><span class="p" data-group-id="3074">]</span><span class="p" data-group-id="3075">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">validate_required</span><span class="p" data-group-id="3110">(</span><span class="p" data-group-id="3109">[</span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">:body</span><span class="p" data-group-id="3109">]</span><span class="p" data-group-id="3110">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k" data-group-id="3161">do</span><span class="w">
    </span><span class="p" data-group-id="3128">%{</span><span class="ss">valid?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p">,</span><span class="w"> </span><span class="ss">changes</span><span class="p">:</span><span class="w"> </span><span class="n">changes</span><span class="p" data-group-id="3128">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p" data-group-id="3135">%{}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="c1"># If the changeset is invalid and has no changes, it is
</span><span class="w">      </span><span class="c1"># because all required fields are missing, so we ignore it.
</span><span class="w">      </span><span class="p" data-group-id="3155">%{</span><span class="n">changeset</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="ss">action</span><span class="p">:</span><span class="w"> </span><span class="ss">:ignore</span><span class="p" data-group-id="3155">}</span><span class="w">
    </span><span class="n">changeset</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">changeset</span><span class="w">
  </span><span class="k" data-group-id="3161">end</span><span class="w">
</span><span class="k" data-group-id="3162">end</span></code></pre>
<h2 id="cast_assoc/3-alternatives-to-cast_assoc-3" class="section-heading">
  <a href="#cast_assoc/3-alternatives-to-cast_assoc-3" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Alternatives to cast_assoc/3
</h2>

<p><a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> is useful when the associated data is managed alongside
the parent struct, all at once.</p>
<p>To work with a single element of an association, other functions are
more appropriate. For example to insert a single associated struct for a
<code class="inline">has_many</code> association it’s much easier to construct the associated struct
with <a href="Ecto.html#build_assoc/3"><code class="inline">Ecto.build_assoc/3</code></a> and persist it directly with <a href="Ecto.Repo.html#c:insert/2"><code class="inline">Ecto.Repo.insert/2</code></a>.</p>
<p>Furthermore, if each side of the association is managed separately,
it is preferable to use <a href="#put_assoc/3"><code class="inline">put_assoc/3</code></a> and directly instruct Ecto how
the association should look like.</p>
<p>For example, imagine you are receiving a set of tags you want to
associate to an user. Those tags are meant to exist upfront. Using
<a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> won’t work as desired because the tags are not managed
alongside the user. In such cases, <a href="#put_assoc/3"><code class="inline">put_assoc/3</code></a> will work as desired.
With the given parameters:</p>
<pre><code class="nohighlight makeup"><span class="p" data-group-id="3089">%{</span><span class="s2">&quot;name&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;john doe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tags&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3088">[</span><span class="s2">&quot;learner&quot;</span><span class="p" data-group-id="3088">]</span><span class="p" data-group-id="3089">}</span></code></pre>
<p>and then:</p>
<pre><code class="nohighlight makeup"><span class="n">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">all</span><span class="p" data-group-id="3093">(</span><span class="n">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Tag</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">^</span><span class="n">params</span><span class="p" data-group-id="3092">[</span><span class="s2">&quot;tags&quot;</span><span class="p" data-group-id="3092">]</span><span class="p" data-group-id="3093">)</span><span class="w">

</span><span class="n">user</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="p" data-group-id="3120">(</span><span class="ss">:tags</span><span class="p" data-group-id="3120">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">cast</span><span class="p" data-group-id="3131">(</span><span class="n">params</span><span class="p" data-group-id="3131">)</span><span class="w"> </span><span class="c1"># No need to allow :tags as we put them directly
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">put_assoc</span><span class="p" data-group-id="3153">(</span><span class="ss">:tags</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="p" data-group-id="3153">)</span><span class="w"> </span><span class="c1"># Explicitly set the tags</span></code></pre>
<p>Note the changeset must have been previously <code class="inline">cast</code> using <a href="#cast/4"><code class="inline">cast/4</code></a>
before this function is invoked.</p>
<h2 id="cast_assoc/3-options" class="section-heading">
  <a href="#cast_assoc/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:with</code> - the function to build the changeset from params.
Defaults to the changeset/2 function in the association module
</li>
<li><code class="inline">:required</code> - if the association is a required field
</li>
<li><code class="inline">:required_message</code> - the message on failure, defaults to “can’t be blank”
</li>
<li><code class="inline">:invalid_message</code> - the message on failure, defaults to “is invalid”
</li>
</ul>

  </section>
</div>
<div class="detail" id="cast_embed/3">
  
  
    <span id="cast_embed/2"></span>
  
  <div class="detail-header">
    <a href="#cast_embed/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">cast_embed(changeset, name, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L685" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Casts the given embed with the changeset parameters.</p>
<p>The parameters for the given embed will be retrieved
from <code class="inline">changeset.params</code>. Those parameters are expected to be
a map with attributes, similar to the ones passed to <a href="#cast/4"><code class="inline">cast/4</code></a>.
Once parameters are retrieved, <a href="#cast_embed/3"><code class="inline">cast_embed/3</code></a> will match those
parameters with the embeds already in the changeset record.
See <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> for an example of working with casts and
associations which would also apply for embeds.</p>
<p>The changeset must have been previously <code class="inline">cast</code> using
<a href="#cast/4"><code class="inline">cast/4</code></a> before this function is invoked.</p>
<h2 id="cast_embed/3-options" class="section-heading">
  <a href="#cast_embed/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:with</code> - the function to build the changeset from params.
Defaults to the changeset/2 function in the embed module
</li>
<li><code class="inline">:required</code> - if the embed is a required field
</li>
<li><code class="inline">:required_message</code> - the message on failure, defaults to “can’t be blank”
</li>
<li><code class="inline">:invalid_message</code> - the message on failure, defaults to “is invalid”
</li>
</ul>

  </section>
</div>
<div class="detail" id="change/2">
  
  
    <span id="change/1"></span>
  
  <div class="detail-header">
    <a href="#change/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">change(data, changes \\ %{})</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L338" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>change(<a href="Ecto.Schema.html#t:t/0">Ecto.Schema.t</a> | <a href="#t:t/0">t</a> | {<a href="#t:data/0">data</a>, <a href="#t:types/0">types</a>}, %{optional(atom) => term} | <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) ::
  <a href="#t:t/0">t</a> |
  no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Wraps the given data in a changeset or adds changes to a changeset.</p>
<p>Changed attributes will only be added if the change does not have the
same value as the field in the data.</p>
<p>This function is useful for:</p>
<ul>
<li>wrapping a struct inside a changeset
</li>
<li>directly changing a struct without performing castings nor validations
</li>
<li>directly bulk-adding changes to a changeset
</li>
</ul>
<p>The function is meant for working with data internal to the application.
Because of that neither validation nor casting is performed. This means
<a href="#change/2"><code class="inline">change/2</code></a> expects the keys in the <code class="inline">changes</code> map or keyword to be atoms.</p>
<p>When a changeset is passed as the first argument, the changes passed as the
second argument are merged over the changes already in the changeset if they
differ from the values in the struct. If <code class="inline">changes</code> is an empty map, this
function is a no-op.</p>
<p>When a <code class="inline">{data, types}</code> is passed as the first argument, a changeset is
created with the given data and types and marked as valid.</p>
<p>See <a href="#cast/4"><code class="inline">cast/4</code></a> if you’d prefer to cast and validate external parameters.</p>
<h2 id="change/2-examples" class="section-heading">
  <a href="#change/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3213">(</span><span class="p" data-group-id="3212">%</span><span class="nc" data-group-id="3212">Post</span><span class="p" data-group-id="3212">{}</span><span class="p" data-group-id="3213">)</span><span class="w">
</span><span class="p" data-group-id="3218">%</span><span class="nc" data-group-id="3218">Ecto.Changeset</span><span class="p" data-group-id="3218">{</span><span class="o">...</span><span class="p" data-group-id="3218">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w">
</span><span class="no">true</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3222">%{}</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3232">(</span><span class="p" data-group-id="3226">%</span><span class="nc" data-group-id="3226">Post</span><span class="p" data-group-id="3226">{</span><span class="ss">author</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3226">}</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p" data-group-id="3232">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3236">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p" data-group-id="3236">}</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3249">(</span><span class="p" data-group-id="3247">%</span><span class="nc" data-group-id="3247">Post</span><span class="p" data-group-id="3247">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p" data-group-id="3247">}</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p" data-group-id="3249">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3254">%{}</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3273">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3272">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;new title&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;body&quot;</span><span class="p" data-group-id="3272">}</span><span class="p" data-group-id="3273">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">title</span><span class="w">
</span><span class="s2">&quot;new title&quot;</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">body</span><span class="w">
</span><span class="s2">&quot;body&quot;</span></code></pre>

  </section>
</div>
<div class="detail" id="check_constraint/3">
  
  
    <span id="check_constraint/2"></span>
  
  <div class="detail-header">
    <a href="#check_constraint/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">check_constraint(changeset, field, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1984" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Checks for a check constraint in the given field.</p>
<p>The check constraint works by relying on the database to check
if the check constraint has been violated or not and, if so,
Ecto converts it into a changeset error.</p>
<h2 id="check_constraint/3-options" class="section-heading">
  <a href="#check_constraint/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message in case the constraint check fails.
Defaults to “is invalid”
</li>
<li><code class="inline">:name</code> - the name of the constraint. Required.
</li>
<li><code class="inline">:match</code> - how the changeset constraint name is matched against the
repo constraint, may be <code class="inline">:exact</code> or <code class="inline">:suffix</code>. Defaults to <code class="inline">:exact</code>.
<code class="inline">:suffix</code> matches any repo constraint which <code class="inline">ends_with?</code> <code class="inline">:name</code>
 to this changeset constraint.
</li>
</ul>

  </section>
</div>
<div class="detail" id="delete_change/2">
  
  
  <div class="detail-header">
    <a href="#delete_change/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">delete_change(changeset, key)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1185" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>delete_change(<a href="#t:t/0">t</a>, atom) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Deletes a change with the given key.</p>
<h2 id="delete_change/2-examples" class="section-heading">
  <a href="#delete_change/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3342">(</span><span class="p" data-group-id="3335">%</span><span class="nc" data-group-id="3335">Post</span><span class="p" data-group-id="3335">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3341">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3341">}</span><span class="p" data-group-id="3342">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delete_change</span><span class="p" data-group-id="3351">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="3351">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">get_change</span><span class="p" data-group-id="3355">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="3355">)</span><span class="w">
</span><span class="no">nil</span></code></pre>

  </section>
</div>
<div class="detail" id="exclusion_constraint/3">
  
  
    <span id="exclusion_constraint/2"></span>
  
  <div class="detail-header">
    <a href="#exclusion_constraint/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">exclusion_constraint(changeset, field, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L2258" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Checks for an exclusion constraint in the given field.</p>
<p>The exclusion constraint works by relying on the database to check
if the exclusion constraint has been violated or not and, if so,
Ecto converts it into a changeset error.</p>
<h2 id="exclusion_constraint/3-options" class="section-heading">
  <a href="#exclusion_constraint/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message in case the constraint check fails,
defaults to “violates an exclusion constraint”
</li>
<li><code class="inline">:name</code> - the constraint name. By default, the constraint
name is inferred from the table + field. May be required
explicitly for complex cases
</li>
<li><code class="inline">:match</code> - how the changeset constraint name is matched against the
repo constraint, may be <code class="inline">:exact</code> or <code class="inline">:suffix</code>. Defaults to <code class="inline">:exact</code>.
<code class="inline">:suffix</code> matches any repo constraint which <code class="inline">ends_with?</code> <code class="inline">:name</code>
 to this changeset constraint.
</li>
</ul>

  </section>
</div>
<div class="detail" id="fetch_change/2">
  
  
  <div class="detail-header">
    <a href="#fetch_change/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">fetch_change(changeset, key)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L964" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>fetch_change(<a href="#t:t/0">t</a>, atom) :: {:ok, term} | :error</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Fetches a change from the given changeset.</p>
<p>This function only looks at the <code class="inline">:changes</code> field of the given <code class="inline">changeset</code> and
returns <code class="inline">{:ok, value}</code> if the change is present or <code class="inline">:error</code> if it’s not.</p>
<h2 id="fetch_change/2-examples" class="section-heading">
  <a href="#fetch_change/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3386">(</span><span class="p" data-group-id="3376">%</span><span class="nc" data-group-id="3376">Post</span><span class="p" data-group-id="3376">{</span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3376">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3385">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3385">}</span><span class="p" data-group-id="3386">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">fetch_change</span><span class="p" data-group-id="3391">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="3391">)</span><span class="w">
</span><span class="p" data-group-id="3398">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3398">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">fetch_change</span><span class="p" data-group-id="3408">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:body</span><span class="p" data-group-id="3408">)</span><span class="w">
</span><span class="ss">:error</span></code></pre>

  </section>
</div>
<div class="detail" id="fetch_field/2">
  
  
  <div class="detail-header">
    <a href="#fetch_field/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">fetch_field(changeset, key)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L886" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>fetch_field(<a href="#t:t/0">t</a>, atom) ::
  {:changes, term} |
  {:data, term} |
  :error</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Fetches the given field from changes or from the data.</p>
<p>While <a href="#fetch_change/2"><code class="inline">fetch_change/2</code></a> only looks at the current <code class="inline">changes</code>
to retrieve a value, this function looks at the changes and
then falls back on the data, finally returning <code class="inline">:error</code> if
no value is available.</p>
<p>For relations, these functions will return the changeset
original data with changes applied. To retrieve raw changesets,
please use <a href="#fetch_change/2"><code class="inline">fetch_change/2</code></a>.</p>
<h2 id="fetch_field/2-examples" class="section-heading">
  <a href="#fetch_field/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3421">%</span><span class="nc" data-group-id="3421">Post</span><span class="p" data-group-id="3421">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bar baz bong&quot;</span><span class="p" data-group-id="3421">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3428">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3427">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New title&quot;</span><span class="p" data-group-id="3427">}</span><span class="p" data-group-id="3428">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">fetch_field</span><span class="p" data-group-id="3429">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="3429">)</span><span class="w">
</span><span class="p" data-group-id="3435">{</span><span class="ss">:changes</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;New title&quot;</span><span class="p" data-group-id="3435">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">fetch_field</span><span class="p" data-group-id="3437">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:body</span><span class="p" data-group-id="3437">)</span><span class="w">
</span><span class="p" data-group-id="3444">{</span><span class="ss">:data</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Bar baz bong&quot;</span><span class="p" data-group-id="3444">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">fetch_field</span><span class="p" data-group-id="3445">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:not_a_field</span><span class="p" data-group-id="3445">)</span><span class="w">
</span><span class="ss">:error</span></code></pre>

  </section>
</div>
<div class="detail" id="force_change/3">
  
  
  <div class="detail-header">
    <a href="#force_change/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">force_change(changeset, key, value)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1163" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>force_change(<a href="#t:t/0">t</a>, atom, term) :: <a href="#t:t/0">t</a> | no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Forces a change on the given <code class="inline">key</code> with <code class="inline">value</code>.</p>
<p>If the change is already present, it is overridden with
the new value.</p>
<h2 id="force_change/3-examples" class="section-heading">
  <a href="#force_change/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3459">(</span><span class="p" data-group-id="3456">%</span><span class="nc" data-group-id="3456">Post</span><span class="p" data-group-id="3456">{</span><span class="ss">author</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3456">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3458">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3458">}</span><span class="p" data-group-id="3459">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">force_change</span><span class="p" data-group-id="3464">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3464">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3467">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3467">}</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">force_change</span><span class="p" data-group-id="3475">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:author</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3475">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3487">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">author</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3487">}</span></code></pre>

  </section>
</div>
<div class="detail" id="foreign_key_constraint/3">
  
  
    <span id="foreign_key_constraint/2"></span>
  
  <div class="detail-header">
    <a href="#foreign_key_constraint/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">foreign_key_constraint(changeset, field, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L2134" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>foreign_key_constraint(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Checks for foreign key constraint in the given field.</p>
<p>The foreign key constraint works by relying on the database to
check if the associated data exists or not. This is useful to
guarantee that a child will only be created if the parent exists
in the database too.</p>
<p>In order to use the foreign key constraint the first step is
to define the foreign key in a migration. This is often done
with references. For example, imagine you are creating a
comments table that belongs to posts. One would have:</p>
<pre><code class="nohighlight makeup"><span class="n">create</span><span class="w"> </span><span class="n">table</span><span class="p" data-group-id="3506">(</span><span class="ss">:comments</span><span class="p" data-group-id="3506">)</span><span class="w"> </span><span class="k" data-group-id="3515">do</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="ss">:post_id</span><span class="p">,</span><span class="w"> </span><span class="n">references</span><span class="p" data-group-id="3512">(</span><span class="ss">:posts</span><span class="p" data-group-id="3512">)</span><span class="w">
</span><span class="k" data-group-id="3515">end</span></code></pre>
<p>By default, Ecto will generate a foreign key constraint with
name “comments_post_id_fkey” (the name is configurable).</p>
<p>Now that a constraint exists, when creating comments, we could
annotate the changeset with foreign key constraint so Ecto knows
how to convert it into an error message:</p>
<pre><code class="nohighlight makeup"><span class="n">cast</span><span class="p" data-group-id="3511">(</span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3510">[</span><span class="ss">:post_id</span><span class="p" data-group-id="3510">]</span><span class="p" data-group-id="3511">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">foreign_key_constraint</span><span class="p" data-group-id="3517">(</span><span class="ss">:post_id</span><span class="p" data-group-id="3517">)</span></code></pre>
<p>Now, when invoking <code class="inline">Repo.insert/2</code> or <code class="inline">Repo.update/2</code>, if the
associated post does not exist, it will be converted into an
error and <code class="inline">{:error, changeset}</code> returned by the repository.</p>
<h2 id="foreign_key_constraint/3-options" class="section-heading">
  <a href="#foreign_key_constraint/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message in case the constraint check fails,
defaults to “does not exist”
</li>
<li><code class="inline">:name</code> - the constraint name. By default, the constraint
name is inferred from the table + field. May be required
explicitly for complex cases
</li>
</ul>

  </section>
</div>
<div class="detail" id="get_change/3">
  
  
    <span id="get_change/2"></span>
  
  <div class="detail-header">
    <a href="#get_change/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">get_change(changeset, key, default \\ nil)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L981" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>get_change(<a href="#t:t/0">t</a>, atom, term) :: term</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Gets a change or returns a default value.</p>
<h2 id="get_change/3-examples" class="section-heading">
  <a href="#get_change/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3529">(</span><span class="p" data-group-id="3527">%</span><span class="nc" data-group-id="3527">Post</span><span class="p" data-group-id="3527">{</span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3527">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3528">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3528">}</span><span class="p" data-group-id="3529">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">get_change</span><span class="p" data-group-id="3534">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="3534">)</span><span class="w">
</span><span class="s2">&quot;bar&quot;</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">get_change</span><span class="p" data-group-id="3539">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:body</span><span class="p" data-group-id="3539">)</span><span class="w">
</span><span class="no">nil</span></code></pre>

  </section>
</div>
<div class="detail" id="get_field/3">
  
  
    <span id="get_field/2"></span>
  
  <div class="detail-header">
    <a href="#get_field/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">get_field(changeset, key, default \\ nil)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L918" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>get_field(<a href="#t:t/0">t</a>, atom, term) :: term</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Gets a field from changes or from the data.</p>
<p>While <a href="#get_change/3"><code class="inline">get_change/3</code></a> only looks at the current <code class="inline">changes</code>
to retrieve a value, this function looks at the changes and
then falls back on the data, finally returning <code class="inline">default</code> if
no value is available.</p>
<p>For relations, these functions will return the changeset data
with changes applied. To retrieve raw changesets, please use <a href="#get_change/3"><code class="inline">get_change/3</code></a>.</p>
<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3559">%</span><span class="nc" data-group-id="3559">Post</span><span class="p" data-group-id="3559">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A title&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My body is a cage&quot;</span><span class="p" data-group-id="3559">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3564">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3563">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A new title&quot;</span><span class="p" data-group-id="3563">}</span><span class="p" data-group-id="3564">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">get_field</span><span class="p" data-group-id="3569">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="3569">)</span><span class="w">
</span><span class="s2">&quot;A new title&quot;</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">get_field</span><span class="p" data-group-id="3575">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:not_a_field</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Told you, not a field!&quot;</span><span class="p" data-group-id="3575">)</span><span class="w">
</span><span class="s2">&quot;Told you, not a field!&quot;</span></code></pre>

  </section>
</div>
<div class="detail" id="merge/2">
  
  
  <div class="detail-header">
    <a href="#merge/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">merge(changeset1, changeset2)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L837" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>merge(<a href="#t:t/0">t</a>, <a href="#t:t/0">t</a>) :: <a href="#t:t/0">t</a> | no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Merges two changesets.</p>
<p>This function merges two changesets provided they have been applied to the
same data (their <code class="inline">:data</code> field is equal); if the data differs, an
<a href="https://hexdocs.pm/elixir/ArgumentError.html"><code class="inline">ArgumentError</code></a> exception is raised. If one of the changesets has a <code class="inline">:repo</code>
field which is not <code class="inline">nil</code>, then the value of that field is used as the <code class="inline">:repo</code>
field of the resulting changeset; if both changesets have a non-<code class="inline">nil</code> and
different <code class="inline">:repo</code> field, an <a href="https://hexdocs.pm/elixir/ArgumentError.html"><code class="inline">ArgumentError</code></a> exception is raised.</p>
<p>The other fields are merged with the following criteria:</p>
<ul>
<li><code class="inline">params</code> - params are merged (not deep-merged) giving precedence to the
params of <code class="inline">changeset2</code> in case of a conflict. If both changesets have their
<code class="inline">:params</code> fields set to <code class="inline">nil</code>, the resulting changeset will have its params
set to <code class="inline">nil</code> too.
</li>
<li><code class="inline">changes</code> - changes are merged giving precedence to the <code class="inline">changeset2</code>
changes.
</li>
<li><code class="inline">errors</code> and <code class="inline">validations</code> - they are simply concatenated.
</li>
<li><code class="inline">required</code> - required fields are merged; all the fields that appear
in the required list of both changesets are moved to the required
list of the resulting changeset.
</li>
</ul>
<h2 id="merge/2-examples" class="section-heading">
  <a href="#merge/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="3591">(</span><span class="p" data-group-id="3588">%</span><span class="nc" data-group-id="3588">Post</span><span class="p" data-group-id="3588">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3589">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Title&quot;</span><span class="p" data-group-id="3589">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3590">[</span><span class="ss">:title</span><span class="p" data-group-id="3590">]</span><span class="p" data-group-id="3591">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="3600">(</span><span class="p" data-group-id="3592">%</span><span class="nc" data-group-id="3592">Post</span><span class="p" data-group-id="3592">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3596">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New title&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Body&quot;</span><span class="p" data-group-id="3596">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3599">[</span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">:body</span><span class="p" data-group-id="3599">]</span><span class="p" data-group-id="3600">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">merge</span><span class="p" data-group-id="3602">(</span><span class="n">changeset1</span><span class="p">,</span><span class="w"> </span><span class="n">changeset2</span><span class="p" data-group-id="3602">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3604">%{</span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Body&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New title&quot;</span><span class="p" data-group-id="3604">}</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="3612">(</span><span class="p" data-group-id="3607">%</span><span class="nc" data-group-id="3607">Post</span><span class="p" data-group-id="3607">{</span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Body&quot;</span><span class="p" data-group-id="3607">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3610">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Title&quot;</span><span class="p" data-group-id="3610">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3611">[</span><span class="ss">:title</span><span class="p" data-group-id="3611">]</span><span class="p" data-group-id="3612">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="3621">(</span><span class="p" data-group-id="3616">%</span><span class="nc" data-group-id="3616">Post</span><span class="p" data-group-id="3616">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3618">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New title&quot;</span><span class="p" data-group-id="3618">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3620">[</span><span class="ss">:title</span><span class="p" data-group-id="3620">]</span><span class="p" data-group-id="3621">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">merge</span><span class="p" data-group-id="3626">(</span><span class="n">changeset1</span><span class="p">,</span><span class="w"> </span><span class="n">changeset2</span><span class="p" data-group-id="3626">)</span><span class="w">
</span><span class="o">**</span><span class="w"> </span><span class="p" data-group-id="3633">(</span><span class="nc">ArgumentError</span><span class="p" data-group-id="3633">)</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="ss">:data</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">merging</span><span class="w"> </span><span class="n">changesets</span></code></pre>

  </section>
</div>
<div class="detail" id="no_assoc_constraint/3">
  
  
    <span id="no_assoc_constraint/2"></span>
  
  <div class="detail-header">
    <a href="#no_assoc_constraint/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">no_assoc_constraint(changeset, assoc, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L2223" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>no_assoc_constraint(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a> | no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Checks the associated field does not exist.</p>
<p>This is similar to <a href="#foreign_key_constraint/3"><code class="inline">foreign_key_constraint/3</code></a> except that the
field is inferred from the association definition. This is useful
to guarantee that parent can only be deleted (or have its primary
key changed) if no child exists in the database. Therefore, it only
applies to <code class="inline">has_*</code> associations.</p>
<p>As the name says, a constraint is required in the database for
this function to work. Such constraint is often added as a
reference to the child table:</p>
<pre><code class="nohighlight makeup"><span class="n">create</span><span class="w"> </span><span class="n">table</span><span class="p" data-group-id="3641">(</span><span class="ss">:comments</span><span class="p" data-group-id="3641">)</span><span class="w"> </span><span class="k" data-group-id="3644">do</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="ss">:post_id</span><span class="p">,</span><span class="w"> </span><span class="n">references</span><span class="p" data-group-id="3643">(</span><span class="ss">:posts</span><span class="p" data-group-id="3643">)</span><span class="w">
</span><span class="k" data-group-id="3644">end</span></code></pre>
<p>Now, when deleting the post, it is possible to forbid any post to
be deleted if they still have comments attached to it:</p>
<pre><code class="nohighlight makeup"><span class="n">post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">change</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">no_assoc_constraint</span><span class="p" data-group-id="3645">(</span><span class="ss">:comments</span><span class="p" data-group-id="3645">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">delete</span></code></pre>
<h2 id="no_assoc_constraint/3-options" class="section-heading">
  <a href="#no_assoc_constraint/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message in case the constraint check fails,
defaults to “is still associated with this entry” (for has_one)
and “are still associated with this entry” (for has_many)
</li>
<li><code class="inline">:name</code> - the constraint name. By default, the constraint
name is inferred from the association table + association
field. May be required explicitly for complex cases
</li>
</ul>

  </section>
</div>
<div class="detail" id="optimistic_lock/3">
  
  
    <span id="optimistic_lock/2"></span>
  
  <div class="detail-header">
    <a href="#optimistic_lock/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">optimistic_lock(data_or_changeset, field, incrementer \\ &amp;(&amp;1 + 1))</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1922" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>optimistic_lock(<a href="Ecto.Schema.html#t:t/0">Ecto.Schema.t</a> | <a href="#t:t/0">t</a>, atom, (integer -> integer)) ::
  <a href="#t:t/0">t</a> |
  no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Applies optimistic locking to the changeset.</p>
<p><a href="http://en.wikipedia.org/wiki/Optimistic_concurrency_control">Optimistic
locking</a> (or
<em>optimistic concurrency control</em>) is a technique that allows concurrent edits
on a single record. While pessimistic locking works by locking a resource for
an entire transaction, optimistic locking only checks if the resource changed
before updating it.</p>
<p>This is done by regularly fetching the record from the database, then checking
whether another user has made changes to the record <em>only when updating the
record</em>. This behaviour is ideal in situations where the chances of concurrent
updates to the same record are low; if they’re not, pessimistic locking or
other concurrency patterns may be more suited.</p>
<h2 id="optimistic_lock/3-usage" class="section-heading">
  <a href="#optimistic_lock/3-usage" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Usage
</h2>

<p>Optimistic locking works by keeping a “version” counter for each record; this
counter gets incremented each time a modification is made to a record. Hence,
in order to use optimistic locking, a field must exist in your schema for
versioning purpose. Such field is usually an integer but other types are
supported.</p>
<h2 id="optimistic_lock/3-examples" class="section-heading">
  <a href="#optimistic_lock/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<p>Assuming we have a <code class="inline">Post</code> schema (stored in the <code class="inline">posts</code> table), the first step
is to add a version column to the <code class="inline">posts</code> table:</p>
<pre><code class="nohighlight makeup"><span class="n">alter</span><span class="w"> </span><span class="n">table</span><span class="p" data-group-id="3654">(</span><span class="ss">:posts</span><span class="p" data-group-id="3654">)</span><span class="w"> </span><span class="k" data-group-id="3662">do</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="ss">:lock_version</span><span class="p">,</span><span class="w"> </span><span class="ss">:integer</span><span class="p">,</span><span class="w"> </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="k" data-group-id="3662">end</span></code></pre>
<p>The column name is arbitrary and doesn’t need to be <code class="inline">:lock_version</code>. Now add
a field to the schema too:</p>
<pre><code class="nohighlight makeup"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Post</span><span class="w"> </span><span class="k" data-group-id="3696">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s2">&quot;posts&quot;</span><span class="w"> </span><span class="k" data-group-id="3676">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:lock_version</span><span class="p">,</span><span class="w"> </span><span class="ss">:integer</span><span class="p">,</span><span class="w"> </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="k" data-group-id="3676">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">changeset</span><span class="p" data-group-id="3681">(</span><span class="ss">:update</span><span class="p">,</span><span class="w"> </span><span class="n">struct</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="3680">%{}</span><span class="p" data-group-id="3681">)</span><span class="w"> </span><span class="k" data-group-id="3695">do</span><span class="w">
    </span><span class="n">struct</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">cast</span><span class="p" data-group-id="3689">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3688">[</span><span class="ss">:title</span><span class="p" data-group-id="3688">]</span><span class="p" data-group-id="3689">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">optimistic_lock</span><span class="p" data-group-id="3694">(</span><span class="ss">:lock_version</span><span class="p" data-group-id="3694">)</span><span class="w">
  </span><span class="k" data-group-id="3695">end</span><span class="w">
</span><span class="k" data-group-id="3696">end</span></code></pre>
<p>Now let’s take optimistic locking for a spin:</p>
<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert!</span><span class="p" data-group-id="3661">(</span><span class="p" data-group-id="3660">%</span><span class="nc" data-group-id="3660">Post</span><span class="p" data-group-id="3660">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3660">}</span><span class="p" data-group-id="3661">)</span><span class="w">
</span><span class="p" data-group-id="3677">%</span><span class="nc" data-group-id="3677">Post</span><span class="p" data-group-id="3677">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">lock_version</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3677">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">valid_change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3683">(</span><span class="ss">:update</span><span class="p">,</span><span class="w"> </span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3682">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3682">}</span><span class="p" data-group-id="3683">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">stale_change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3700">(</span><span class="ss">:update</span><span class="p">,</span><span class="w"> </span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3699">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;baz&quot;</span><span class="p" data-group-id="3699">}</span><span class="p" data-group-id="3700">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="3703">(</span><span class="n">valid_change</span><span class="p" data-group-id="3703">)</span><span class="w">
</span><span class="p" data-group-id="3707">%</span><span class="nc" data-group-id="3707">Post</span><span class="p" data-group-id="3707">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">lock_version</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3707">}</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="3711">(</span><span class="n">stale_change</span><span class="p" data-group-id="3711">)</span><span class="w">
</span><span class="o">**</span><span class="w"> </span><span class="p" data-group-id="3712">(</span><span class="nc">Ecto.StaleEntryError</span><span class="p" data-group-id="3712">)</span><span class="w"> </span><span class="n">attempted</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">stale</span><span class="w"> </span><span class="ss">entry</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="3713">%</span><span class="nc" data-group-id="3713">Post</span><span class="p" data-group-id="3713">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;baz&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">lock_version</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3713">}</span></code></pre>
<p>When a conflict happens (a record which has been previously fetched is
being updated, but that same record has been modified since it was
fetched), an <a href="Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a> exception is raised.</p>
<p>Optimistic locking also works with delete operations. Just call the
<a href="#optimistic_lock/3"><code class="inline">optimistic_lock/3</code></a> function with the data before delete:</p>
<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">optimistic_lock</span><span class="p" data-group-id="3659">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="ss">:lock_version</span><span class="p" data-group-id="3659">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">delete</span><span class="p" data-group-id="3668">(</span><span class="n">changeset</span><span class="p" data-group-id="3668">)</span></code></pre>
<p><a href="#optimistic_lock/3"><code class="inline">optimistic_lock/3</code></a> by default assumes the field
being used as a lock is an integer. If you want to use another type,
you need to pass the third argument customizing how the next value
is generated:</p>
<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">optimistic_lock</span><span class="p" data-group-id="3670">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="ss">:lock_uuid</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3669">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Ecto.UUID</span><span class="o">.</span><span class="n">generate</span><span class="w"> </span><span class="k" data-group-id="3669">end</span><span class="p" data-group-id="3670">)</span></code></pre>

  </section>
</div>
<div class="detail" id="prepare_changes/2">
  
  
  <div class="detail-header">
    <a href="#prepare_changes/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">prepare_changes(changeset, function)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1960" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>prepare_changes(<a href="#t:t/0">t</a>, (<a href="#t:t/0">t</a> -> <a href="#t:t/0">t</a>)) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Provides a function to run before emitting changes to the repository.</p>
<p>Such function receives the changeset and must return a changeset,
allowing developers to do final adjustments to the changeset or to
issue data consistency commands.</p>
<p>The given function is guaranteed to run inside the same transaction
as the changeset operation for databases that do support transactions.</p>
<h2 id="prepare_changes/2-example" class="section-heading">
  <a href="#prepare_changes/2-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<p>A common use case is updating a counter cache, in this case updating a post’s
comment count when a comment is created:</p>
<pre><code class="nohighlight makeup"><span class="kd">def</span><span class="w"> </span><span class="nf">create_comment</span><span class="p" data-group-id="3714">(</span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p" data-group-id="3714">)</span><span class="w"> </span><span class="k" data-group-id="3722">do</span><span class="w">
  </span><span class="n">comment</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="3716">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3715">[</span><span class="ss">:body</span><span class="p">,</span><span class="w"> </span><span class="ss">:post_id</span><span class="p" data-group-id="3715">]</span><span class="p" data-group-id="3716">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">prepare_changes</span><span class="p" data-group-id="3721">(</span><span class="k" data-group-id="3720">fn</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="n">assoc</span><span class="p" data-group-id="3717">(</span><span class="n">changeset</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="3717">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">update_all</span><span class="p" data-group-id="3719">(</span><span class="ss">inc</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3718">[</span><span class="ss">comment_count</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3718">]</span><span class="p" data-group-id="3719">)</span><span class="w">
    </span><span class="n">changeset</span><span class="w">
  </span><span class="k" data-group-id="3720">end</span><span class="p" data-group-id="3721">)</span><span class="w">
</span><span class="k" data-group-id="3722">end</span></code></pre>
<p>We retrieve the repo from the comment changeset itself and use
update_all to update the counter cache in one query. Finally, the original
changeset must be returned.</p>

  </section>
</div>
<div class="detail" id="put_assoc/4">
  
  
    <span id="put_assoc/3"></span>
  
  <div class="detail-header">
    <a href="#put_assoc/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">put_assoc(changeset, name, value, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1098" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Puts the given association as a change in the changeset.</p>
<p>This function should be used when working with the entire association at
once (and not a single element of a many-style association) and using data
internal to the application.</p>
<p>When updating the data, this function requires the association to have been
preloaded in the changeset struct. Missing data will invoke the <code class="inline">:on_replace</code>
behaviour defined on the association. Preloading is not necessary for newly
built structs.</p>
<p>The given value may either be the association struct, a changeset for the
given association or a map or keyword list of changes to be applied to the
current association. On all cases, it is expected the keys to be atoms. If a
map or keyword list are given and there is no association, one will be created.</p>
<p>If the association has no changes, it will be skipped. If the association is
invalid, the changeset will be marked as invalid. If the given value is not any
of the above, it will raise.</p>
<p>Also see <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> for a discussion of when to use <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> and
<a href="#put_assoc/3"><code class="inline">put_assoc/3</code></a>.</p>
<p>Although it accepts an <code class="inline">opts</code> argument, there are no options currently supported
by <a href="#put_assoc/4"><code class="inline">put_assoc/4</code></a>.</p>

  </section>
</div>
<div class="detail" id="put_change/3">
  
  
  <div class="detail-header">
    <a href="#put_change/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">put_change(changeset, key, value)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1037" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>put_change(<a href="#t:t/0">t</a>, atom, term) :: <a href="#t:t/0">t</a> | no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Puts a change on the given <code class="inline">key</code> with <code class="inline">value</code>.</p>
<p>If the change is already present, it is overridden with
the new value, also, if the change has the same value as
in the changeset data, it is not added to the list of changes.</p>
<p>The function is meant for working with data internal to the application.</p>
<h2 id="put_change/3-examples" class="section-heading">
  <a href="#put_change/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3725">(</span><span class="p" data-group-id="3723">%</span><span class="nc" data-group-id="3723">Post</span><span class="p" data-group-id="3723">{</span><span class="ss">author</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3723">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3724">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3724">}</span><span class="p" data-group-id="3725">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">put_change</span><span class="p" data-group-id="3726">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3726">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3727">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3727">}</span><span class="w">

</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">put_change</span><span class="p" data-group-id="3728">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:author</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3728">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="w">
</span><span class="p" data-group-id="3729">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p" data-group-id="3729">}</span></code></pre>

  </section>
</div>
<div class="detail" id="put_embed/4">
  
  
    <span id="put_embed/3"></span>
  
  <div class="detail-header">
    <a href="#put_embed/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">put_embed(changeset, name, value, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1124" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Puts the given embed as a change in the changeset.</p>
<p>The given value may either be the embed struct, a
changeset for the given embed or a map or keyword
list of changes to be applied to the current embed.
On all cases, it is expected the keys to be atoms.
If a map or keyword list are given and there is no
embed, one will be created.</p>
<p>If the embed has no changes, it will be skipped.
If the embed is invalid, the changeset will be marked
as invalid. If the given value is not an embed struct
or changeset, it will raise.</p>
<p>Also see <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> for a discussion of when to use
<a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a> and <a href="#put_assoc/3"><code class="inline">put_assoc/3</code></a> which also applies to
<a href="#put_embed/3"><code class="inline">put_embed/3</code></a>.</p>
<p>Although it accepts an <code class="inline">opts</code> argument, there are no
options currently supported by <a href="#put_embed/4"><code class="inline">put_embed/4</code></a>.</p>

  </section>
</div>
<div class="detail" id="traverse_errors/2">
  
  
  <div class="detail-header">
    <a href="#traverse_errors/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">traverse_errors(changeset, msg_func)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L2332" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>traverse_errors(<a href="#t:t/0">t</a>, (<a href="#t:error/0">error</a> -> <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>) | (<a href="Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>, atom, <a href="#t:error/0">error</a> -> <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>)) :: %{optional(atom) => [<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>]}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Traverses changeset errors and applies the given function to error messages.</p>
<p>This function is particularly useful when associations and embeds
are cast in the changeset as it will traverse all associations and
embeds and place all errors in a series of nested maps.</p>
<p>A changeset is supplied along with a function to apply to each
error message as the changeset is traversed. The error message
function receives an error tuple <code class="inline">{msg, opts}</code>, for example:</p>
<pre><code class="nohighlight makeup"><span class="p" data-group-id="3732">{</span><span class="s2">&quot;should be at least %{count} characters&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3731">[</span><span class="ss">count</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">validation</span><span class="p">:</span><span class="w"> </span><span class="ss">:length</span><span class="p">,</span><span class="w"> </span><span class="ss">min</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3731">]</span><span class="p" data-group-id="3732">}</span></code></pre>
<h2 id="traverse_errors/2-examples" class="section-heading">
  <a href="#traverse_errors/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">traverse_errors</span><span class="p" data-group-id="3742">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3741">fn</span><span class="w"> </span><span class="p" data-group-id="3730">{</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p" data-group-id="3730">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="3740">(</span><span class="n">opts</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3739">fn</span><span class="w"> </span><span class="p" data-group-id="3733">{</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="3733">}</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">     </span><span class="nc">String</span><span class="o">.</span><span class="n">replace</span><span class="p" data-group-id="3738">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;%{</span><span class="si" data-group-id="3736">#{</span><span class="n">key</span><span class="si" data-group-id="3736">}</span><span class="s2">}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">to_string</span><span class="p" data-group-id="3737">(</span><span class="n">value</span><span class="p" data-group-id="3737">)</span><span class="p" data-group-id="3738">)</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="k" data-group-id="3739">end</span><span class="p" data-group-id="3740">)</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w"> </span><span class="k" data-group-id="3741">end</span><span class="p" data-group-id="3742">)</span><span class="w">
</span><span class="p" data-group-id="3744">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3743">[</span><span class="s2">&quot;should be at least 3 characters&quot;</span><span class="p" data-group-id="3743">]</span><span class="p" data-group-id="3744">}</span></code></pre>
<p>Optionally function can accept three arguments: <code class="inline">changeset</code>, <code class="inline">field</code>
and error tuple <code class="inline">{msg, opts}</code>. It is useful whenever you want to extract
validations rules from <code class="inline">changeset.validations</code> to build detailed error
description.</p>

  </section>
</div>
<div class="detail" id="unique_constraint/3">
  
  
    <span id="unique_constraint/2"></span>
  
  <div class="detail-header">
    <a href="#unique_constraint/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">unique_constraint(changeset, field, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L2086" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>unique_constraint(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Checks for a unique constraint in the given field.</p>
<p>The unique constraint works by relying on the database to check
if the unique constraint has been violated or not and, if so,
Ecto converts it into a changeset error.</p>
<p>In order to use the uniqueness constraint, the first step is
to define the unique index in a migration:</p>
<pre><code class="nohighlight makeup"><span class="n">create</span><span class="w"> </span><span class="n">unique_index</span><span class="p" data-group-id="3746">(</span><span class="ss">:users</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3745">[</span><span class="ss">:email</span><span class="p" data-group-id="3745">]</span><span class="p" data-group-id="3746">)</span></code></pre>
<p>Now that a constraint exists, when modifying users, we could
annotate the changeset with unique constraint so Ecto knows
how to convert it into an error message:</p>
<pre><code class="nohighlight makeup"><span class="n">cast</span><span class="p" data-group-id="3748">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3747">[</span><span class="ss">:email</span><span class="p" data-group-id="3747">]</span><span class="p" data-group-id="3748">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">unique_constraint</span><span class="p" data-group-id="3757">(</span><span class="ss">:email</span><span class="p" data-group-id="3757">)</span></code></pre>
<p>Now, when invoking <code class="inline">Repo.insert/2</code> or <code class="inline">Repo.update/2</code>, if the
email already exists, it will be converted into an error and
<code class="inline">{:error, changeset}</code> returned by the repository. Note that the error
will occur only after hitting the database so it will not be visible
until all other validations pass.</p>
<h2 id="unique_constraint/3-options" class="section-heading">
  <a href="#unique_constraint/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message in case the constraint check fails,
defaults to “has already been taken”
</li>
<li><code class="inline">:name</code> - the constraint name. By default, the constraint
name is inferred from the table + field. May be required
explicitly for complex cases
</li>
<li><code class="inline">:match</code> - how the changeset constraint name is matched against the
repo constraint, may be <code class="inline">:exact</code> or <code class="inline">:suffix</code>. Defaults to <code class="inline">:exact</code>.
<code class="inline">:suffix</code> matches any repo constraint which <code class="inline">ends_with?</code> <code class="inline">:name</code>
 to this changeset constraint.
</li>
</ul>
<h2 id="unique_constraint/3-complex-constraints" class="section-heading">
  <a href="#unique_constraint/3-complex-constraints" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Complex constraints
</h2>

<p>Because the constraint logic is in the database, we can leverage
all the database functionality when defining them. For example,
let’s suppose the e-mails are scoped by company id. We would write
in a migration:</p>
<pre><code class="nohighlight makeup"><span class="n">create</span><span class="w"> </span><span class="n">unique_index</span><span class="p" data-group-id="3753">(</span><span class="ss">:users</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3752">[</span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">:company_id</span><span class="p" data-group-id="3752">]</span><span class="p" data-group-id="3753">)</span></code></pre>
<p>Because such indexes have usually more complex names, we need
to explicitly tell the changeset which constraint name to use (here we’re
using the naming convention that <code class="inline">unique_index</code> uses):</p>
<pre><code class="nohighlight makeup"><span class="n">cast</span><span class="p" data-group-id="3750">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3749">[</span><span class="ss">:email</span><span class="p" data-group-id="3749">]</span><span class="p" data-group-id="3750">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">unique_constraint</span><span class="p" data-group-id="3761">(</span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:users_email_company_id_index</span><span class="p" data-group-id="3761">)</span></code></pre>
<p>Notice that the first param is just one of the unique index fields, this will
be used as the error key to the changeset errors keyword list. For example,
the above <a href="#unique_constraint/3"><code class="inline">unique_constraint/3</code></a> would generate something like:</p>
<pre><code class="nohighlight makeup"><span class="nc">Repo</span><span class="o">.</span><span class="n">insert!</span><span class="p" data-group-id="3760">(</span><span class="p" data-group-id="3759">%</span><span class="nc" data-group-id="3759">User</span><span class="p" data-group-id="3759">{</span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@elixir.org&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">company_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3759">}</span><span class="p" data-group-id="3760">)</span><span class="w">
</span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3770">(</span><span class="p" data-group-id="3764">%</span><span class="nc" data-group-id="3764">User</span><span class="p" data-group-id="3764">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3769">%{</span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@elixir.org&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">company_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3769">}</span><span class="p" data-group-id="3770">)</span><span class="w">
</span><span class="p" data-group-id="3771">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="3771">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="3772">(</span><span class="n">changeset</span><span class="p" data-group-id="3772">)</span><span class="w">
</span><span class="n">changeset</span><span class="o">.</span><span class="n">errors</span><span class="w"> </span><span class="c1">#=&gt; [email: {&quot;has already been taken&quot;, []}]</span></code></pre>
<p>Alternatively, you can give both <code class="inline">unique_index</code> and <code class="inline">unique_constraint</code>
the same name:</p>
<pre><code class="nohighlight makeup"><span class="c1"># In the migration
</span><span class="n">create</span><span class="w"> </span><span class="n">unique_index</span><span class="p" data-group-id="3758">(</span><span class="ss">:users</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3756">[</span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">:company_id</span><span class="p" data-group-id="3756">]</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:users_email_company_id_index</span><span class="p" data-group-id="3758">)</span><span class="w">

</span><span class="c1"># In the changeset function
</span><span class="n">cast</span><span class="p" data-group-id="3763">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3762">[</span><span class="ss">:email</span><span class="p" data-group-id="3762">]</span><span class="p" data-group-id="3763">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">unique_constraint</span><span class="p" data-group-id="3768">(</span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:users_email_company_id_index</span><span class="p" data-group-id="3768">)</span></code></pre>
<h2 id="unique_constraint/3-case-sensitivity" class="section-heading">
  <a href="#unique_constraint/3-case-sensitivity" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Case sensitivity
</h2>

<p>Unfortunately, different databases provide different guarantees
when it comes to case-sensitiveness. For example, in MySQL, comparisons
are case-insensitive by default. In Postgres, users can define case
insensitive column by using the <code class="inline">:citext</code> type/extension. In your migration:</p>
<pre><code class="nohighlight makeup"><span class="n">execute</span><span class="w"> </span><span class="s2">&quot;CREATE EXTENSION IF NOT EXISTS citext&quot;</span><span class="w">
</span><span class="n">create</span><span class="w"> </span><span class="n">table</span><span class="p" data-group-id="3751">(</span><span class="ss">:users</span><span class="p" data-group-id="3751">)</span><span class="w"> </span><span class="k" data-group-id="3765">do</span><span class="w">
  </span><span class="o">...</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">:citext</span><span class="w">
  </span><span class="o">...</span><span class="w">
</span><span class="k" data-group-id="3765">end</span></code></pre>
<p>If for some reason your database does not support case insensitive columns,
you can explicitly downcase values before inserting/updating them:</p>
<pre><code class="nohighlight makeup"><span class="n">cast</span><span class="p" data-group-id="3755">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3754">[</span><span class="ss">:email</span><span class="p" data-group-id="3754">]</span><span class="p" data-group-id="3755">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">update_change</span><span class="p" data-group-id="3766">(</span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">String</span><span class="o">.</span><span class="n">downcase</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="3766">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">unique_constraint</span><span class="p" data-group-id="3767">(</span><span class="ss">:email</span><span class="p" data-group-id="3767">)</span></code></pre>

  </section>
</div>
<div class="detail" id="unsafe_validate_unique/4">
  
  
    <span id="unsafe_validate_unique/3"></span>
  
  <div class="detail-header">
    <a href="#unsafe_validate_unique/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">unsafe_validate_unique(changeset, fields, repo, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1422" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Validates that no existing record with a different primary key
has the same values for these fields.</p>
<p>This function exists to provide quick feedback to users of your
application. It should not be relied on for any data guarantee as it
has race conditions and is inherently unsafe. For example, if this
check happens twice in the same time interval (because the user
submitted a form twice), both checks may pass and you may end-up with
duplicate entries in the database. Therefore, a <a href="#unique_constraint/3"><code class="inline">unique_constraint/3</code></a>
should also be used to ensure your data won’t get corrupted.</p>
<p>However, because constraints are only checked if all validations
succeed, this function can be used as an early check to provide
early feedback to users, since most conflicting data will have been
inserted prior to the current validation phase.</p>
<h2 id="unsafe_validate_unique/4-examples" class="section-heading">
  <a href="#unsafe_validate_unique/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">unsafe_validate_unique</span><span class="p" data-group-id="3774">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3773">[</span><span class="ss">:email</span><span class="p" data-group-id="3773">]</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="p" data-group-id="3774">)</span><span class="w">
</span><span class="n">unsafe_validate_unique</span><span class="p" data-group-id="3776">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3775">[</span><span class="ss">:city_name</span><span class="p">,</span><span class="w"> </span><span class="ss">:state_name</span><span class="p" data-group-id="3775">]</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="p" data-group-id="3776">)</span><span class="w">
</span><span class="n">unsafe_validate_unique</span><span class="p" data-group-id="3778">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3777">[</span><span class="ss">:city_name</span><span class="p">,</span><span class="w"> </span><span class="ss">:state_name</span><span class="p" data-group-id="3777">]</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;city must be unique within state&quot;</span><span class="p" data-group-id="3778">)</span><span class="w">
</span><span class="n">unsafe_validate_unique</span><span class="p" data-group-id="3780">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3779">[</span><span class="ss">:city_name</span><span class="p">,</span><span class="w"> </span><span class="ss">:state_name</span><span class="p" data-group-id="3779">]</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;public&quot;</span><span class="p" data-group-id="3780">)</span></code></pre>

  </section>
</div>
<div class="detail" id="update_change/3">
  
  
  <div class="detail-header">
    <a href="#update_change/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">update_change(changeset, key, function)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1001" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>update_change(<a href="#t:t/0">t</a>, atom, (term -> term)) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Updates a change.</p>
<p>The given <code class="inline">function</code> is invoked with the change value only if there
is a change for the given <code class="inline">key</code>. Note that the value of the change
can still be <code class="inline">nil</code> (unless the field was marked as required on <a href="#validate_required/3"><code class="inline">validate_required/3</code></a>).</p>
<h2 id="update_change/3-examples" class="section-heading">
  <a href="#update_change/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3783">(</span><span class="p" data-group-id="3781">%</span><span class="nc" data-group-id="3781">Post</span><span class="p" data-group-id="3781">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3782">%{</span><span class="ss">impressions</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3782">}</span><span class="p" data-group-id="3783">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_change</span><span class="p" data-group-id="3785">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:impressions</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="3784">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3784">)</span><span class="p" data-group-id="3785">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">impressions</span><span class="w">
</span><span class="mi">2</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_acceptance/3">
  
  
    <span id="validate_acceptance/2"></span>
  
  <div class="detail-header">
    <a href="#validate_acceptance/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_acceptance(changeset, field, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1833" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_acceptance(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates the given parameter was given as true.</p>
<p>This validation is used to check for one specific parameter being true
and as such does not require the field to effectively exist in the schema
or the data being validated.</p>
<h2 id="validate_acceptance/3-options" class="section-heading">
  <a href="#validate_acceptance/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message on failure, defaults to “must be accepted”
</li>
</ul>
<h2 id="validate_acceptance/3-examples" class="section-heading">
  <a href="#validate_acceptance/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_acceptance</span><span class="p" data-group-id="3786">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:terms_of_service</span><span class="p" data-group-id="3786">)</span><span class="w">
</span><span class="n">validate_acceptance</span><span class="p" data-group-id="3787">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:rules</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;please accept rules&quot;</span><span class="p" data-group-id="3787">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_change/3">
  
  
  <div class="detail-header">
    <a href="#validate_change/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_change(changeset, field, validator)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1307" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_change(<a href="#t:t/0">t</a>, atom, (atom, term -> [{atom, <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>} | {atom, {<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>}}])) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates the given <code class="inline">field</code> change.</p>
<p>It invokes the <code class="inline">validator</code> function to perform the validation
only if a change for the given <code class="inline">field</code> exists and the change
value is not <code class="inline">nil</code>. The function must return a list of errors
(with an empty list meaning no errors).</p>
<p>In case there’s at least one error, the list of errors will be appended to the
<code class="inline">:errors</code> field of the changeset and the <code class="inline">:valid?</code> flag will be set to
<code class="inline">false</code>.</p>
<h2 id="validate_change/3-examples" class="section-heading">
  <a href="#validate_change/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3790">(</span><span class="p" data-group-id="3788">%</span><span class="nc" data-group-id="3788">Post</span><span class="p" data-group-id="3788">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3789">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3789">}</span><span class="p" data-group-id="3790">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validate_change</span><span class="w"> </span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3794">fn</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w">  </span><span class="o">-&gt;</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="c1"># Value must not be &quot;foo&quot;!
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="w"> </span><span class="k" data-group-id="3793">do</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">     </span><span class="p" data-group-id="3791">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cannot be foo&quot;</span><span class="p" data-group-id="3791">]</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="k" data-group-id="3793">else</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">     </span><span class="p" data-group-id="3792">[]</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="k" data-group-id="3793">end</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w"> </span><span class="k" data-group-id="3794">end</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">errors</span><span class="w">
</span><span class="p" data-group-id="3797">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3796">{</span><span class="s2">&quot;cannot be foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3795">[]</span><span class="p" data-group-id="3796">}</span><span class="p" data-group-id="3797">]</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_change/4">
  
  
  <div class="detail-header">
    <a href="#validate_change/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_change(changeset, field, metadata, validator)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1346" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_change(<a href="#t:t/0">t</a>, atom, term, (atom, term -> [{atom, <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>} | {atom, {<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>}}])) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Stores the validation <code class="inline">metadata</code> and validates the given <code class="inline">field</code> change.</p>
<p>Similar to <a href="#validate_change/3"><code class="inline">validate_change/3</code></a> but stores the validation metadata
into the changeset validators. The validator metadata is often used
as a reflection mechanism, to automatically generate code based on
the available validations.</p>
<h2 id="validate_change/4-examples" class="section-heading">
  <a href="#validate_change/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">change</span><span class="p" data-group-id="3800">(</span><span class="p" data-group-id="3798">%</span><span class="nc" data-group-id="3798">Post</span><span class="p" data-group-id="3798">{}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3799">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p" data-group-id="3799">}</span><span class="p" data-group-id="3800">)</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validate_change</span><span class="w"> </span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">:useless_validator</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3802">fn</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w">   </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="3801">[]</span><span class="w">
</span><span class="gp">...&gt;</span><span class="w"> </span><span class="k" data-group-id="3802">end</span><span class="w">
</span><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">validations</span><span class="w">
</span><span class="p" data-group-id="3803">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="ss">:useless_validator</span><span class="p" data-group-id="3803">]</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_confirmation/3">
  
  
    <span id="validate_confirmation/2"></span>
  
  <div class="detail-header">
    <a href="#validate_confirmation/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_confirmation(changeset, field, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1792" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_confirmation(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates that the given field matches the confirmation
parameter of that field.</p>
<p>By calling <code class="inline">validate_confirmation(changeset, :email)</code>, this
validation will check if both “email” and “email_confirmation”
in the parameter map matches.</p>
<p>Note that if the confirmation field is nil or missing, by default this does
not add a validation error. You can specify that the confirmation field is
required in the options (see below). Note “email_confirmation” does not need
to be added as a virtual field in your schema.</p>
<h2 id="validate_confirmation/3-options" class="section-heading">
  <a href="#validate_confirmation/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message on failure, defaults to “does not match”
</li>
<li><code class="inline">:required</code> - boolean, sets whether existence of confirmation parameter
is required for addition of error. Defaults to false
</li>
</ul>
<h2 id="validate_confirmation/3-examples" class="section-heading">
  <a href="#validate_confirmation/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_confirmation</span><span class="p" data-group-id="3804">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p" data-group-id="3804">)</span><span class="w">
</span><span class="n">validate_confirmation</span><span class="p" data-group-id="3805">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:password</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;does not match password&quot;</span><span class="p" data-group-id="3805">)</span><span class="w">

</span><span class="n">cast</span><span class="p" data-group-id="3807">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3806">[</span><span class="ss">:password</span><span class="p" data-group-id="3806">]</span><span class="p" data-group-id="3807">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">validate_confirmation</span><span class="p" data-group-id="3808">(</span><span class="ss">:password</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;does not match password&quot;</span><span class="p" data-group-id="3808">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_exclusion/4">
  
  
    <span id="validate_exclusion/3"></span>
  
  <div class="detail-header">
    <a href="#validate_exclusion/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_exclusion(changeset, field, data, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1587" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_exclusion(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Enum.html#t:t/0">Enum.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates a change is not included in the given enumerable.</p>
<h2 id="validate_exclusion/4-options" class="section-heading">
  <a href="#validate_exclusion/4-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message on failure, defaults to “is reserved”
</li>
</ul>
<h2 id="validate_exclusion/4-examples" class="section-heading">
  <a href="#validate_exclusion/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_exclusion</span><span class="p" data-group-id="3809">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="sx">~w(admin superadmin)</span><span class="p" data-group-id="3809">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_format/4">
  
  
    <span id="validate_format/3"></span>
  
  <div class="detail-header">
    <a href="#validate_format/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_format(changeset, field, format, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1522" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_format(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Regex.html#t:t/0">Regex.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates a change has the given format.</p>
<p>The format has to be expressed as a regular expression.</p>
<h2 id="validate_format/4-options" class="section-heading">
  <a href="#validate_format/4-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message on failure, defaults to “has invalid format”
</li>
</ul>
<h2 id="validate_format/4-examples" class="section-heading">
  <a href="#validate_format/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_format</span><span class="p" data-group-id="3810">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="sr">~r/@/</span><span class="p" data-group-id="3810">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_inclusion/4">
  
  
    <span id="validate_inclusion/3"></span>
  
  <div class="detail-header">
    <a href="#validate_inclusion/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_inclusion(changeset, field, data, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1542" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_inclusion(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Enum.html#t:t/0">Enum.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates a change is included in the given enumerable.</p>
<h2 id="validate_inclusion/4-options" class="section-heading">
  <a href="#validate_inclusion/4-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message on failure, defaults to “is invalid”
</li>
</ul>
<h2 id="validate_inclusion/4-examples" class="section-heading">
  <a href="#validate_inclusion/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_inclusion</span><span class="p" data-group-id="3812">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:gender</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3811">[</span><span class="s2">&quot;man&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;woman&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;other&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;prefer not to say&quot;</span><span class="p" data-group-id="3811">]</span><span class="p" data-group-id="3812">)</span><span class="w">
</span><span class="n">validate_inclusion</span><span class="p" data-group-id="3813">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:age</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">99</span><span class="p" data-group-id="3813">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_length/3">
  
  
  <div class="detail-header">
    <a href="#validate_length/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_length(changeset, field, opts)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1629" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_length(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates a change is a string or list of the given length.</p>
<p>Note that the length of a string is counted in graphemes. If using
this validation to match a character limit of a database backend,
it’s likely that the limit ignores graphemes and limits the number
of unicode characters. Then consider using the <code class="inline">:count</code> option to
limit the number of codepoints.</p>
<h2 id="validate_length/3-options" class="section-heading">
  <a href="#validate_length/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:is</code> - the length must be exactly this value
</li>
<li><code class="inline">:min</code> - the length must be greater than or equal to this value
</li>
<li><code class="inline">:max</code> - the length must be less than or equal to this value
</li>
<li><code class="inline">:count</code> - what length to count for string, <code class="inline">:graphemes</code> (default) or <code class="inline">:codepoints</code>
</li>
<li><p><code class="inline">:message</code> - the message on failure, depending on the validation, is one of:</p>
<ul>
<li><p>for strings:</p>
<ul>
<li>“should be %{count} character(s)”
</li>
<li>“should be at least %{count} character(s)”
</li>
<li>“should be at most %{count} character(s)”
</li>
</ul>
</li>
<li><p>for lists:</p>
<ul>
<li>“should have %{count} item(s)”
</li>
<li>“should have at least %{count} item(s)”
</li>
<li>“should have at most %{count} item(s)”
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="validate_length/3-examples" class="section-heading">
  <a href="#validate_length/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_length</span><span class="p" data-group-id="3814">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">min</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3814">)</span><span class="w">
</span><span class="n">validate_length</span><span class="p" data-group-id="3815">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">max</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="3815">)</span><span class="w">
</span><span class="n">validate_length</span><span class="p" data-group-id="3816">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">min</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">max</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="3816">)</span><span class="w">
</span><span class="n">validate_length</span><span class="p" data-group-id="3817">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:code</span><span class="p">,</span><span class="w"> </span><span class="ss">is</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p" data-group-id="3817">)</span><span class="w">
</span><span class="n">validate_length</span><span class="p" data-group-id="3818">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:topics</span><span class="p">,</span><span class="w"> </span><span class="ss">is</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3818">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_number/3">
  
  
  <div class="detail-header">
    <a href="#validate_number/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_number(changeset, field, opts)</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1706" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_number(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a> | no_return</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates the properties of a number.</p>
<h2 id="validate_number/3-options" class="section-heading">
  <a href="#validate_number/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:less_than</code>
</li>
<li><code class="inline">:greater_than</code>
</li>
<li><code class="inline">:less_than_or_equal_to</code>
</li>
<li><code class="inline">:greater_than_or_equal_to</code>
</li>
<li><code class="inline">:equal_to</code>
</li>
<li><p><code class="inline">:message</code> - the message on failure, defaults to one of:</p>
<ul>
<li>“must be less than %{number}”
</li>
<li>“must be greater than %{number}”
</li>
<li>“must be less than or equal to %{number}”
</li>
<li>“must be greater than or equal to %{number}”
</li>
<li>“must be equal to %{number}”
</li>
</ul>
</li>
</ul>
<h2 id="validate_number/3-examples" class="section-heading">
  <a href="#validate_number/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_number</span><span class="p" data-group-id="3819">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:count</span><span class="p">,</span><span class="w"> </span><span class="ss">less_than</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3819">)</span><span class="w">
</span><span class="n">validate_number</span><span class="p" data-group-id="3820">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:pi</span><span class="p">,</span><span class="w"> </span><span class="ss">greater_than</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">less_than</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="3820">)</span><span class="w">
</span><span class="n">validate_number</span><span class="p" data-group-id="3821">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:the_answer_to_life_the_universe_and_everything</span><span class="p">,</span><span class="w"> </span><span class="ss">equal_to</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="3821">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_required/3">
  
  
    <span id="validate_required/2"></span>
  
  <div class="detail-header">
    <a href="#validate_required/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_required(changeset, fields, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1376" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_required(<a href="#t:t/0">t</a>, list | atom, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates that one or more fields are present in the changeset.</p>
<p>If the value of a field is <code class="inline">nil</code> or a string made only of whitespace,
the changeset is marked as invalid and an error is added. Note the
error won’t be added though if the field already has an error.</p>
<p>You can pass a single field name or a list of field names that
are required.</p>
<p>Do not use this function to validate associations are required,
instead pass the <code class="inline">:required</code> option to <a href="#cast_assoc/3"><code class="inline">cast_assoc/3</code></a>.</p>
<h2 id="validate_required/3-options" class="section-heading">
  <a href="#validate_required/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message on failure, defaults to “can’t be blank”
</li>
</ul>
<h2 id="validate_required/3-examples" class="section-heading">
  <a href="#validate_required/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_required</span><span class="p" data-group-id="3822">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="3822">)</span><span class="w">
</span><span class="n">validate_required</span><span class="p" data-group-id="3824">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3823">[</span><span class="ss">:title</span><span class="p">,</span><span class="w"> </span><span class="ss">:body</span><span class="p" data-group-id="3823">]</span><span class="p" data-group-id="3824">)</span></code></pre>

  </section>
</div>
<div class="detail" id="validate_subset/4">
  
  
    <span id="validate_subset/3"></span>
  
  <div class="detail-header">
    <a href="#validate_subset/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">validate_subset(changeset, field, data, opts \\ [])</span>
    
      <a href="https://github.com/elixir-ecto/ecto/blob/v3.0.0-dev/lib/ecto/changeset.ex#L1565" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>validate_subset(<a href="#t:t/0">t</a>, atom, <a href="https://hexdocs.pm/elixir/Enum.html#t:t/0">Enum.t</a>, <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>) :: <a href="#t:t/0">t</a></pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Validates a change, of type enum, is a subset of the given enumerable. Like
<a href="#validate_inclusion/4"><code class="inline">validate_inclusion/4</code></a> for lists.</p>
<h2 id="validate_subset/4-options" class="section-heading">
  <a href="#validate_subset/4-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:message</code> - the message on failure, defaults to “has an invalid entry”
</li>
</ul>
<h2 id="validate_subset/4-examples" class="section-heading">
  <a href="#validate_subset/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">validate_subset</span><span class="p" data-group-id="3826">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:pets</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3825">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dog&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;parrot&quot;</span><span class="p" data-group-id="3825">]</span><span class="p" data-group-id="3826">)</span><span class="w">
</span><span class="n">validate_subset</span><span class="p" data-group-id="3827">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">:lottery_numbers</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">99</span><span class="p" data-group-id="3827">)</span></code></pre>

  </section>
</div>

        </section>
      

      
          <footer class="footer">
        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" rel="help" target="_blank">ExDoc</a> (v0.17.1),
          </span>
          <span class="line">
            designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" title="@dignifiedquire">Friedel Ziegelmayer</a>.
            </span>
        </p>
        <button class="night-mode-toggle"><span class="sr-only">Switch theme</span></button>
      </footer>
    </div>
  </div>
</section>
</div>
  <script src="dist/app-4cfb39be16.js"></script>
  <script src="assets/makedown.js"></script>
  </body>
</html>

